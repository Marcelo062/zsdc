#if 0
	shc Version 4.0.1, Generic Shell Script Compiler
	GNU GPL Version 3 Md Jahidul Hamid <jahidulhamid@yahoo.com>

	shc -f menu 
#endif

static  char data [] = 
#define      inlo_z	3
#define      inlo	((&data[0]))
	"\136\066\232"
#define      msg1_z	65
#define      msg1	((&data[6]))
	"\025\154\145\033\155\201\157\351\046\314\005\212\073\210\217\115"
	"\223\244\270\065\147\014\332\316\305\046\226\134\362\230\041\374"
	"\011\006\266\174\270\250\117\343\046\003\360\046\260\135\334\135"
	"\153\157\006\102\171\000\174\125\267\006\366\114\033\345\301\204"
	"\037\060\012\211\006\007\263\263\221"
#define      date_z	1
#define      date	((&data[76]))
	"\272"
#define      rlax_z	1
#define      rlax	((&data[77]))
	"\304"
#define      text_z	2516
#define      text	((&data[151]))
	"\347\253\157\171\374\360\332\106\073\063\202\132\140\333\160\315"
	"\101\166\324\365\052\146\050\074\002\341\053\366\263\111\302\233"
	"\364\061\024\360\042\356\066\135\041\271\270\202\224\050\117\326"
	"\236\044\313\311\212\363\005\214\325\060\203\210\172\106\043\156"
	"\167\070\137\232\046\225\367\110\117\123\244\207\356\230\202\136"
	"\000\003\114\107\345\247\017\144\166\000\332\076\011\054\131\367"
	"\275\317\231\367\104\333\370\164\217\307\261\357\352\056\355\210"
	"\321\320\173\032\140\353\247\301\232\046\074\073\372\216\373\227"
	"\022\047\313\206\317\324\252\007\035\105\076\335\124\065\374\334"
	"\311\221\050\033\012\155\170\132\277\306\057\243\354\026\260\360"
	"\250\163\157\033\271\155\053\143\322\333\252\236\145\343\045\167"
	"\053\112\100\270\151\064\356\213\207\370\030\052\377\074\224\116"
	"\255\051\111\231\104\016\024\221\202\032\052\121\236\000\061\070"
	"\217\151\115\201\162\164\262\027\013\127\216\274\015\103\100\050"
	"\120\175\174\373\252\163\070\203\053\007\047\354\152\330\067\010"
	"\320\117\100\144\040\272\200\316\372\243\275\374\200\060\232\133"
	"\242\242\260\153\053\236\005\153\170\216\260\272\327\311\110\061"
	"\134\130\037\232\125\143\310\030\170\261\202\065\360\123\315\212"
	"\275\132\360\204\343\253\146\121\114\235\102\205\105\116\105\222"
	"\036\204\371\131\030\375\210\042\353\254\026\163\176\244\344\232"
	"\311\202\224\310\106\133\112\150\050\241\355\151\143\314\161\331"
	"\263\035\064\373\366\355\323\034\371\033\304\124\231\243\043\037"
	"\230\233\034\070\156\066\073\235\120\220\254\376\257\035\023\216"
	"\102\304\243\070\150\231\322\125\242\105\067\036\353\043\270\145"
	"\363\075\372\210\360\355\036\076\147\130\142\340\000\132\116\040"
	"\221\344\334\054\154\252\264\044\270\077\367\360\342\261\123\053"
	"\210\100\206\275\302\320\017\244\362\110\176\063\003\346\111\017"
	"\302\015\161\153\343\210\022\111\014\031\126\166\253\357\263\316"
	"\314\336\175\012\120\164\302\142\002\163\263\222\163\173\346\176"
	"\117\361\036\244\100\113\230\257\327\046\166\066\026\204\322\011"
	"\200\322\343\152\355\220\375\021\337\321\157\065\142\245\362\263"
	"\155\063\144\226\137\213\273\005\144\057\311\025\074\046\064\315"
	"\015\165\036\362\373\216\224\234\146\040\141\125\222\177\104\365"
	"\172\251\133\132\133\015\034\002\340\163\360\225\071\260\131\120"
	"\002\254\031\311\135\026\101\022\275\020\337\016\102\042\025\017"
	"\152\237\362\226\276\326\302\022\210\233\064\157\304\030\375\060"
	"\357\222\014\163\363\070\152\277\150\237\020\203\063\316\012\047"
	"\301\256\240\277\233\243\307\247\041\274\244\125\006\260\005\266"
	"\124\275\064\315\270\264\374\152\361\026\341\130\004\354\310\176"
	"\221\075\376\346\267\353\312\007\156\206\206\145\332\123\265\225"
	"\125\256\372\167\225\272\347\046\333\045\371\240\037\001\176\227"
	"\323\335\153\364\213\160\023\211\165\354\251\276\131\100\324\020"
	"\270\115\211\123\247\315\130\204\226\227\102\076\376\144\260\157"
	"\210\367\323\127\215\300\214\156\165\244\044\246\012\353\041\031"
	"\237\226\304\145\025\263\057\155\264\361\242\226\215\317\017\307"
	"\247\031\137\105\272\232\161\300\056\027\113\052\117\376\224\217"
	"\147\230\066\132\212\376\017\103\236\066\225\237\313\132\041\125"
	"\134\340\207\155\166\331\371\115\020\347\032\147\273\247\020\173"
	"\360\275\362\314\307\104\010\246\034\070\255\373\161\061\250\372"
	"\133\152\367\040\025\355\331\071\254\207\350\032\044\146\067\303"
	"\374\112\304\300\214\026\003\205\274\211\120\331\014\325\365\275"
	"\042\166\213\106\123\375\067\320\005\162\364\211\317\343\064\234"
	"\131\166\265\237\064\170\311\254\323\367\366\152\256\142\146\032"
	"\215\235\367\151\263\235\035\220\140\053\161\275\171\025\073\056"
	"\005\007\030\304\045\044\016\270\122\254\312\260\336\174\334\163"
	"\002\005\377\222\033\245\361\212\047\277\267\012\020\262\075\215"
	"\367\362\204\130\210\177\111\065\233\001\350\101\344\027\134\151"
	"\373\170\221\161\325\056\237\217\012\012\016\343\266\047\227\163"
	"\020\353\317\127\346\165\310\035\355\356\007\047\323\103\321\105"
	"\207\231\213\163\044\342\237\255\015\046\015\143\071\020\032\202"
	"\317\115\246\356\345\161\177\312\163\146\140\125\300\223\141\266"
	"\053\003\267\042\232\071\347\327\255\214\046\016\142\066\127\206"
	"\324\071\207\321\304\212\022\313\150\025\255\130\255\254\300\044"
	"\304\074\001\141\173\326\375\070\063\056\100\103\032\115\070\270"
	"\305\045\344\252\143\211\075\027\076\356\313\254\257\166\035\017"
	"\345\315\015\343\202\031\207\264\156\011\226\340\217\035\305\162"
	"\354\357\071\340\322\166\257\054\370\012\171\117\254\034\003\321"
	"\216\356\071\104\267\134\164\022\341\264\051\112\204\327\043\000"
	"\271\042\107\227\033\004\112\045\051\053\021\144\304\260\244\227"
	"\160\002\073\102\157\003\015\117\116\360\125\255\240\347\054\272"
	"\323\127\112\171\216\062\311\100\011\006\356\330\213\077\326\364"
	"\103\173\342\107\001\070\346\051\056\274\341\170\077\030\164\341"
	"\307\276\011\152\143\105\266\041\146\034\003\346\020\244\011\306"
	"\270\061\217\127\363\342\234\043\322\013\037\260\132\015\136\266"
	"\125\042\326\331\267\106\363\022\013\134\324\376\234\015\044\344"
	"\213\154\133\002\220\154\354\376\057\052\031\152\060\125\040\125"
	"\224\125\256\276\024\072\054\103\356\276\265\375\000\003\257\114"
	"\120\034\306\003\025\371\343\226\154\027\365\026\223\343\216\370"
	"\213\320\321\326\236\074\052\265\306\214\264\370\257\242\171\233"
	"\017\107\021\025\024\123\231\056\252\174\313\034\050\207\266\040"
	"\142\361\073\146\330\114\212\212\216\277\357\227\050\206\227\217"
	"\005\216\371\202\011\104\365\003\053\245\207\164\003\255\007\221"
	"\333\272\114\352\315\012\060\153\241\240\167\315\252\354\265\077"
	"\054\331\353\142\042\215\065\045\020\266\311\347\046\232\275\343"
	"\052\361\152\365\227\234\255\025\055\264\042\134\024\042\162\026"
	"\132\132\165\320\317\041\325\357\314\217\221\321\245\104\140\153"
	"\156\226\045\360\256\375\263\245\325\222\116\131\355\020\072\372"
	"\064\174\074\125\367\017\316\166\256\130\100\170\141\102\036\215"
	"\015\370\334\230\145\213\257\055\145\004\000\377\010\134\145\377"
	"\347\354\344\013\331\044\320\147\273\042\144\153\143\277\020\320"
	"\051\237\331\172\332\032\275\232\351\035\021\125\013\220\307\155"
	"\243\303\227\103\330\230\230\375\125\276\006\274\215\346\321\220"
	"\267\115\012\113\216\235\127\367\230\301\067\363\257\056\203\117"
	"\226\267\145\033\114\217\110\134\305\253\043\021\232\126\177\160"
	"\343\360\302\273\366\126\057\224\010\140\065\344\030\345\150\264"
	"\220\240\354\254\175\355\242\375\323\106\020\225\214\324\071\311"
	"\032\206\156\240\377\312\277\216\136\063\145\217\216\016\076\327"
	"\142\144\326\337\151\314\246\353\164\366\055\056\302\035\127\075"
	"\312\110\346\152\060\256\272\023\111\244\062\026\351\343\110\245"
	"\171\001\045\072\212\063\232\110\046\251\101\325\033\142\215\271"
	"\014\023\064\273\221\135\004\313\007\011\340\077\270\122\265\265"
	"\350\237\373\024\277\212\036\014\111\166\213\353\343\301\052\255"
	"\121\022\056\324\173\047\062\034\077\027\135\076\351\204\373\017"
	"\021\333\342\243\371\110\101\052\352\137\040\274\107\037\037\133"
	"\140\075\255\377\266\175\310\021\273\177\245\272\065\370\327\273"
	"\012\367\023\350\130\343\124\131\011\144\336\346\045\246\147\225"
	"\067\276\007\301\027\324\136\145\003\156\205\241\345\315\032\005"
	"\106\251\015\060\270\075\273\215\071\240\216\201\232\345\175\265"
	"\264\345\144\245\335\066\071\101\132\254\265\133\377\264\136\066"
	"\021\341\043\122\126\106\103\213\310\140\170\104\242\026\270\055"
	"\367\150\234\073\224\222\206\053\310\320\054\312\045\134\355\107"
	"\273\224\060\146\265\241\356\072\376\074\252\274\070\367\113\302"
	"\314\124\231\250\067\374\337\260\121\310\204\061\107\101\224\246"
	"\072\271\135\353\215\310\333\201\314\345\205\356\164\041\245\064"
	"\207\114\360\074\206\302\344\202\114\135\022\216\321\336\361\043"
	"\016\265\216\174\367\163\150\126\343\206\021\166\036\262\052\105"
	"\060\143\042\117\236\152\165\241\373\263\002\234\117\375\072\202"
	"\164\204\333\023\236\237\340\040\155\266\273\267\326\144\323\020"
	"\154\142\124\227\167\241\335\316\014\072\274\220\352\055\231\330"
	"\050\173\177\107\262\314\310\027\043\024\007\371\271\175\376\343"
	"\351\053\352\012\172\357\364\316\212\204\107\161\034\246\225\154"
	"\254\031\261\135\011\325\026\272\074\007\064\125\212\141\030\155"
	"\313\340\145\214\220\117\211\277\360\071\232\235\022\326\263\077"
	"\347\365\345\063\302\257\370\043\073\037\054\225\071\241\051\331"
	"\353\137\046\361\341\211\300\213\050\231\224\272\106\242\176\353"
	"\366\150\121\151\206\070\374\340\264\051\074\060\275\060\354\374"
	"\057\143\275\324\354\324\333\115\145\261\367\236\345\276\012\106"
	"\057\013\377\114\234\154\146\243\302\362\075\130\174\013\177\230"
	"\121\350\041\142\110\050\033\110\307\021\200\376\337\271\007\323"
	"\272\112\043\010\260\267\172\316\170\313\341\130\214\162\004\312"
	"\143\060\133\114\340\361\316\000\331\256\112\000\242\147\361\130"
	"\276\232\042\071\354\300\160\154\137\125\207\266\155\035\130\005"
	"\041\263\005\272\232\345\061\260\347\153\116\264\263\070\067\042"
	"\335\071\036\356\316\054\366\113\124\204\231\320\127\274\073\227"
	"\107\107\236\153\167\012\070\352\060\070\257\213\300\245\036\336"
	"\350\112\073\323\376\371\372\103\126\237\204\244\037\350\214\367"
	"\043\167\253\211\236\003\307\041\167\366\126\370\117\355\131\312"
	"\270\264\254\214\247\244\336\330\174\012\212\300\327\032\203\063"
	"\263\024\040\347\217\117\304\135\160\255\175\163\054\027\047\142"
	"\264\007\206\210\223\144\016\342\373\131\342\321\207\155\055\204"
	"\255\047\023\232\220\047\031\144\153\007\125\264\004\142\036\360"
	"\244\033\111\013\017\124\122\137\031\363\347\005\151\344\014\101"
	"\354\251\305\257\233\173\120\165\352\236\071\121\242\016\244\062"
	"\132\271\164\024\135\216\247\127\260\373\061\322\061\040\126\005"
	"\302\322\172\021\020\176\225\052\146\043\337\376\105\077\010\221"
	"\353\327\042\022\213\266\245\315\275\360\170\377\332\227\126\214"
	"\257\205\074\073\176\246\067\103\205\077\231\344\271\162\137\123"
	"\342\237\061\111\276\372\262\337\077\263\351\166\375\036\326\004"
	"\050\117\046\203\373\214\017\260\114\261\376\166\365\347\017\253"
	"\014\022\172\146\110\324\117\362\344\222\203\263\334\176\164\277"
	"\345\064\335\367\266\266\212\017\302\121\277\234\117\177\202\244"
	"\250\017\230\266\030\360\026\133\033\007\046\067\250\051\063\252"
	"\307\124\336\006\141\000\152\147\213\351\332\263\107\103\152\151"
	"\265\260\307\244\242\237\267\153\373\131\305\321\015\327\014\075"
	"\041\140\257\116\223\040\314\144\321\227\061\250\110\026\004\130"
	"\026\066\341\126\362\012\002\247\051\244\051\337\040\274\223\304"
	"\235\016\306\372\154\253\365\145\307\235\373\247\024\273\016\314"
	"\365\272\357\055\025\121\054\257\107\246\352\222\060\064\376\243"
	"\011\011\116\117\331\173\025\163\041\073\306\051\022\021\077\233"
	"\116\052\065\253\200\325\220\122\032\007\152\151\221\340\303\220"
	"\053\341\207\324\342\270\102\207\244\101\050\164\042\010\074\317"
	"\143\237\100\224\354\245\061\226\126\126\105\306\372\257\313\343"
	"\327\033\272\166\100\205\077\312\171\104\127\116\165\333\327\357"
	"\041\373\136\231\063\275\063\132\123\052\243\242\331\156\206\261"
	"\211\100\047\311\306\147\224\100\254\354\217\041\310\146\021\351"
	"\142\160\202\226\055\266\360\201\340\224\044\272\003\253\154\214"
	"\354\224\126\262\373\353\362\247\330\202\311\240\351\333\212\113"
	"\113\014\341\171\302\322\372\243\147\037\136\152\312\312\367\266"
	"\136\116\151\131\071\134\001\022\336\312\263\307\246\075\023\361"
	"\112\364\152\014\307\145\260\056\204\016\230\117\331\217\005\067"
	"\335\156\221\027\312\223\052\251\136\335\160\004\032\203\365\144"
	"\170\140\161\100\305\042\156\112\060\007\231\011\227\237\101\165"
	"\016\323\215\331\146\267\202\304\224\363\310\257\167\276\024\357"
	"\036\206\057\343\250\236\056\330\246\307\342\075\147\044\262\165"
	"\367\077\116\136\366\320\042\213\304\353\073\073\251\117\053\307"
	"\326\132\253\176\371\331\127\237\241\071\334\010\136\217\175\126"
	"\317\314\264\306\235\327\122\141\302\215\234\153\335\307\063\263"
	"\042\336\061\034\267\210\273\130\302\230\140\041\050\336\167\367"
	"\252\053\275\107\002\017\251\305\235\106\060\172\016\143\056\060"
	"\102\137\115\371\350\010\122\253\241\263\314\311\221\103\301\074"
	"\156\177\204\161\216\055\066\054\164\147\246\202\313\324\263\015"
	"\064\000\007\035\010\131\310\252\014\224\164\236\327\065\333\106"
	"\264\137\270\103\215\356\157\001\126\026\204\041\353\067\057\040"
	"\067\066\075\100\220\005\352\235\231\137\073\161\224\027\270\111"
	"\166\160\215\004\137\375\006\265\023\212\327\377\301\006\037\371"
	"\075\134\071\315\141\043\152\373\202\246\154\027\276\044\141\064"
	"\224\356\071\363\354\100\251\377\312\200\376\214\207\035\205\304"
	"\172\277\221\333\343\374\326\146\243\103\175\141\150\337\226\375"
	"\316\320\361\272\020\232\272\333\032\270\150\241\326\356\146\121"
	"\255\370\054\220\365\003\366\230\107\164\372\257\123\221\254\042"
	"\141\235\334\162\070\226\115\123\117\266\365\046\244\133\167\122"
	"\123\244\343\110\250\332\341\357\116\334\237\242\155\114\304\316"
	"\352\241\101\042\067\217\165\206\105\153\255\352\306\044\075\032"
	"\310\040\143"
#define      lsto_z	1
#define      lsto	((&data[3169]))
	"\271"
#define      xecc_z	15
#define      xecc	((&data[3171]))
	"\000\005\227\336\250\107\377\020\342\052\126\241\223\000\337\365"
#define      tst2_z	19
#define      tst2	((&data[3188]))
	"\261\135\112\315\046\173\117\136\057\224\365\376\071\357\172\022"
	"\023\153\030\014\064\067"
#define      tst1_z	22
#define      tst1	((&data[3211]))
	"\212\055\317\103\375\007\332\316\202\144\237\353\315\255\366\020"
	"\272\376\314\052\242\231\000\021\360\021\162"
#define      shll_z	10
#define      shll	((&data[3237]))
	"\002\342\156\344\243\361\016\377\154\267\240\120\232"
#define      chk1_z	22
#define      chk1	((&data[3252]))
	"\200\034\266\305\200\200\165\013\157\135\036\065\012\212\022\164"
	"\273\012\205\332\016\214\363\265\233\360\175\000\345\176"
#define      chk2_z	19
#define      chk2	((&data[3280]))
	"\237\321\172\150\042\255\330\154\173\051\035\315\067\103\327\134"
	"\241\343\025\254\202\002\362\157"
#define      msg2_z	19
#define      msg2	((&data[3304]))
	"\054\216\011\065\257\234\000\063\362\036\042\035\075\340\071\046"
	"\045\043\276\277\311\017\147\114"
#define      opts_z	1
#define      opts	((&data[3326]))
	"\275"
#define      pswd_z	256
#define      pswd	((&data[3360]))
	"\302\005\367\171\312\165\172\260\363\147\045\277\007\366\301\372"
	"\145\035\167\002\111\005\021\260\121\176\032\201\205\240\134\110"
	"\245\076\220\004\122\232\177\072\272\363\341\253\233\077\155\026"
	"\060\277\040\056\165\164\216\042\263\141\325\123\073\073\357\152"
	"\172\200\157\314\033\356\007\325\342\351\201\175\050\356\224\130"
	"\256\264\207\043\051\026\106\334\167\033\060\262\127\037\035\321"
	"\237\215\236\272\174\245\220\136\216\021\334\266\000\160\017\256"
	"\045\227\322\117\255\030\054\045\063\134\330\213\173\365\135\033"
	"\203\373\325\377\241\146\135\057\170\072\346\170\253\366\047\321"
	"\215\371\040\073\021\114\140\105\250\070\321\044\056\056\077\261"
	"\052\025\260\313\173\016\372\363\111\341\154\364\327\223\305\145"
	"\215\346\240\236\062\000\344\333\070\265\000\146\343\077\030\015"
	"\124\310\330\320\327\323\304\040\264\061\025\214\304\332\362\121"
	"\301\222\360\364\222\324\317\313\212\317\062\156\017\112\173\144"
	"\023\124\065\353\050\371\013\335\052\040\151\357\373\134\101\274"
	"\356\061\260\201\006\200\115\221\117\177\377\137\312\172\303\336"
	"\317\370\311\367\362\325\324\035\365\076\014\360\232\115\255\211"
	"\177\135\013\206\336\130\027\056\330\026\215\242\221\121\201\140"
	"\111\124\301\160\311\073\041\275\243\106\174\253\075\075\245\242"
	"\133\034\245\245\041\266\126\163\065\160\364\272\020\121\003\266"
	"\245\304\047\156\000\111\054\244\220\250\117\315\346\364\160\102"
	"\020\025\347\062\314\075\246\001"/* End of data[] */;
#define      hide_z	4096
#define SETUID 0	/* Define as 1 to call setuid(0) at start of script */
#define DEBUGEXEC	0	/* Define as 1 to debug execvp calls */
#define TRACEABLE	1	/* Define as 1 to enable ptrace the executable */
#define HARDENING	0	/* Define as 1 to disable ptrace/dump the executable */
#define HARDENINGSP	0	/* Define as 1 to disable bash child process */
#define BUSYBOXON	0	/* Define as 1 to enable work with busybox */

/* rtc.c */

#include <sys/stat.h>
#include <sys/types.h>

#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>

/* 'Alleged RC4' */

static unsigned char stte[256], indx, jndx, kndx;

/*
 * Reset arc4 stte. 
 */
void stte_0(void)
{
	indx = jndx = kndx = 0;
	do {
		stte[indx] = indx;
	} while (++indx);
}

/*
 * Set key. Can be used more than once. 
 */
void key(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		do {
			tmp = stte[indx];
			kndx += tmp;
			kndx += ptr[(int)indx % len];
			stte[indx] = stte[kndx];
			stte[kndx] = tmp;
		} while (++indx);
		ptr += 256;
		len -= 256;
	}
}

/*
 * Crypt data. 
 */
void arc4(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		indx++;
		tmp = stte[indx];
		jndx += tmp;
		stte[indx] = stte[jndx];
		stte[jndx] = tmp;
		tmp += stte[indx];
		*ptr ^= stte[tmp];
		ptr++;
		len--;
	}
}

/* End of ARC4 */

#if HARDENING

#include <sys/ptrace.h>
#include <sys/wait.h>
#include <signal.h>
#include <sys/prctl.h>
#define PR_SET_PTRACER 0x59616d61

/* Seccomp Sandboxing Init */
#include <stdlib.h>
#include <stdio.h>
#include <stddef.h>
#include <string.h>
#include <unistd.h>
#include <errno.h>

#include <sys/types.h>
#include <sys/prctl.h>
#include <sys/syscall.h>
#include <sys/socket.h>

#include <linux/filter.h>
#include <linux/seccomp.h>
#include <linux/audit.h>

#define ArchField offsetof(struct seccomp_data, arch)

#define Allow(syscall) \
    BPF_JUMP(BPF_JMP+BPF_JEQ+BPF_K, SYS_##syscall, 0, 1), \
    BPF_STMT(BPF_RET+BPF_K, SECCOMP_RET_ALLOW)

struct sock_filter filter[] = {
    /* validate arch */
    BPF_STMT(BPF_LD+BPF_W+BPF_ABS, ArchField),
    BPF_JUMP( BPF_JMP+BPF_JEQ+BPF_K, AUDIT_ARCH_X86_64, 1, 0),
    BPF_STMT(BPF_RET+BPF_K, SECCOMP_RET_KILL),

    /* load syscall */
    BPF_STMT(BPF_LD+BPF_W+BPF_ABS, offsetof(struct seccomp_data, nr)),

    /* list of allowed syscalls */
    Allow(exit_group),  /* exits a processs */
    Allow(brk),         /* for malloc(), inside libc */
    Allow(mmap),        /* also for malloc() */
    Allow(munmap),      /* for free(), inside libc */

    /* and if we don't match above, die */
    BPF_STMT(BPF_RET+BPF_K, SECCOMP_RET_KILL),
};
struct sock_fprog filterprog = {
    .len = sizeof(filter)/sizeof(filter[0]),
    .filter = filter
};

/* Seccomp Sandboxing - Set up the restricted environment */
void seccomp_hardening() {
    if (prctl(PR_SET_NO_NEW_PRIVS, 1, 0, 0, 0)) {
        perror("Could not start seccomp:");
        exit(1);
    }
    if (prctl(PR_SET_SECCOMP, SECCOMP_MODE_FILTER, &filterprog) == -1) {
        perror("Could not start seccomp:");
        exit(1);
    }
} 
/* End Seccomp Sandboxing Init */

void arc4_hardrun(void * str, int len) {
    //Decode locally
    char tmp2[len];
    memcpy(tmp2, str, len);

	unsigned char tmp, * ptr = (unsigned char *)tmp2;

    int lentmp = len;

#if HARDENINGSP
    //Start tracing to protect from dump & trace
    if (ptrace(PTRACE_TRACEME, 0, 0, 0) < 0) {
        printf("Operation not permitted\n");
        kill(getpid(), SIGKILL);
        exit(1);
    }

    //Decode Bash
    while (len > 0) {
        indx++;
        tmp = stte[indx];
        jndx += tmp;
        stte[indx] = stte[jndx];
        stte[jndx] = tmp;
        tmp += stte[indx];
        *ptr ^= stte[tmp];
        ptr++;
        len--;
    }

    //Exec bash script
    system(tmp2);

    //Empty script variable
    memcpy(tmp2, str, lentmp);

    //Sinal to detach ptrace
    ptrace(PTRACE_DETACH, 0, 0, 0);
    exit(0);

    /* Seccomp Sandboxing - Start */
    seccomp_hardening();

    exit(0);
#endif /* HARDENINGSP Exit here anyway*/

    int pid, status;
    pid = fork();

    if(pid==0) {

        //Start tracing to protect from dump & trace
        if (ptrace(PTRACE_TRACEME, 0, 0, 0) < 0) {
            printf("Operation not permitted\n");
            kill(getpid(), SIGKILL);
            _exit(1);
        }

        //Decode Bash
        while (len > 0) {
            indx++;
            tmp = stte[indx];
            jndx += tmp;
            stte[indx] = stte[jndx];
            stte[jndx] = tmp;
            tmp += stte[indx];
            *ptr ^= stte[tmp];
            ptr++;
            len--;
        }

        //Exec bash script
        system(tmp2);

        //Empty script variable
        memcpy(tmp2, str, lentmp);

        //Sinal to detach ptrace
        ptrace(PTRACE_DETACH, 0, 0, 0);
        exit(0);
    }
    else {
        wait(&status);
    }

    /* Seccomp Sandboxing - Start */
    seccomp_hardening();

    exit(0);
} 
#endif /* HARDENING */

/*
 * Key with file invariants. 
 */
int key_with_file(char * file)
{
	struct stat statf[1];
	struct stat control[1];

	if (stat(file, statf) < 0)
		return -1;

	/* Turn on stable fields */
	memset(control, 0, sizeof(control));
	control->st_ino = statf->st_ino;
	control->st_dev = statf->st_dev;
	control->st_rdev = statf->st_rdev;
	control->st_uid = statf->st_uid;
	control->st_gid = statf->st_gid;
	control->st_size = statf->st_size;
	control->st_mtime = statf->st_mtime;
	control->st_ctime = statf->st_ctime;
	key(control, sizeof(control));
	return 0;
}

#if DEBUGEXEC
void debugexec(char * sh11, int argc, char ** argv)
{
	int i;
	fprintf(stderr, "shll=%s\n", sh11 ? sh11 : "<null>");
	fprintf(stderr, "argc=%d\n", argc);
	if (!argv) {
		fprintf(stderr, "argv=<null>\n");
	} else { 
		for (i = 0; i <= argc ; i++)
			fprintf(stderr, "argv[%d]=%.60s\n", i, argv[i] ? argv[i] : "<null>");
	}
}
#endif /* DEBUGEXEC */

void rmarg(char ** argv, char * arg)
{
	for (; argv && *argv && *argv != arg; argv++);
	for (; argv && *argv; argv++)
		*argv = argv[1];
}

void chkenv_end(void);

int chkenv(int argc)
{
	char buff[512];
	unsigned long mask, m;
	int l, a, c;
	char * string;
	extern char ** environ;

	mask = (unsigned long)getpid();
	stte_0();
	 key(&chkenv, (void*)&chkenv_end - (void*)&chkenv);
	 key(&data, sizeof(data));
	 key(&mask, sizeof(mask));
	arc4(&mask, sizeof(mask));
	sprintf(buff, "x%lx", mask);
	string = getenv(buff);
#if DEBUGEXEC
	fprintf(stderr, "getenv(%s)=%s\n", buff, string ? string : "<null>");
#endif
	l = strlen(buff);
	if (!string) {
		/* 1st */
		sprintf(&buff[l], "=%lu %d", mask, argc);
		putenv(strdup(buff));
		return 0;
	}
	c = sscanf(string, "%lu %d%c", &m, &a, buff);
	if (c == 2 && m == mask) {
		/* 3rd */
		rmarg(environ, &string[-l - 1]);
		return 1 + (argc - a);
	}
	return -1;
}

void chkenv_end(void){}

#if HARDENING

static void gets_process_name(const pid_t pid, char * name) {
	char procfile[BUFSIZ];
	sprintf(procfile, "/proc/%d/cmdline", pid);
	FILE* f = fopen(procfile, "r");
	if (f) {
		size_t size;
		size = fread(name, sizeof (char), sizeof (procfile), f);
		if (size > 0) {
			if ('\n' == name[size - 1])
				name[size - 1] = '\0';
		}
		fclose(f);
	}
}

void hardening() {
    prctl(PR_SET_DUMPABLE, 0);
    prctl(PR_SET_PTRACER, -1);

    int pid = getppid();
    char name[256] = {0};
    gets_process_name(pid, name);

    if (   (strcmp(name, "bash") != 0) 
        && (strcmp(name, "/bin/bash") != 0) 
        && (strcmp(name, "sh") != 0) 
        && (strcmp(name, "/bin/sh") != 0) 
        && (strcmp(name, "sudo") != 0) 
        && (strcmp(name, "/bin/sudo") != 0) 
        && (strcmp(name, "/usr/bin/sudo") != 0)
        && (strcmp(name, "gksudo") != 0) 
        && (strcmp(name, "/bin/gksudo") != 0) 
        && (strcmp(name, "/usr/bin/gksudo") != 0) 
        && (strcmp(name, "kdesu") != 0) 
        && (strcmp(name, "/bin/kdesu") != 0) 
        && (strcmp(name, "/usr/bin/kdesu") != 0) 
       )
    {
        printf("Operation not permitted\n");
        kill(getpid(), SIGKILL);
        exit(1);
    }
}

#endif /* HARDENING */

#if !TRACEABLE

#define _LINUX_SOURCE_COMPAT
#include <sys/ptrace.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <fcntl.h>
#include <signal.h>
#include <stdio.h>
#include <unistd.h>

#if !defined(PT_ATTACHEXC) /* New replacement for PT_ATTACH */
   #if !defined(PTRACE_ATTACH) && defined(PT_ATTACH)
       #define PT_ATTACHEXC	PT_ATTACH
   #elif defined(PTRACE_ATTACH)
       #define PT_ATTACHEXC PTRACE_ATTACH
   #endif
#endif

void untraceable(char * argv0)
{
	char proc[80];
	int pid, mine;

	switch(pid = fork()) {
	case  0:
		pid = getppid();
		/* For problematic SunOS ptrace */
#if defined(__FreeBSD__)
		sprintf(proc, "/proc/%d/mem", (int)pid);
#else
		sprintf(proc, "/proc/%d/as",  (int)pid);
#endif
		close(0);
		mine = !open(proc, O_RDWR|O_EXCL);
		if (!mine && errno != EBUSY)
			mine = !ptrace(PT_ATTACHEXC, pid, 0, 0);
		if (mine) {
			kill(pid, SIGCONT);
		} else {
			perror(argv0);
			kill(pid, SIGKILL);
		}
		_exit(mine);
	case -1:
		break;
	default:
		if (pid == waitpid(pid, 0, 0))
			return;
	}
	perror(argv0);
	_exit(1);
}
#endif /* !TRACEABLE */

char * xsh(int argc, char ** argv)
{
	char * scrpt;
	int ret, i, j;
	char ** varg;
	char * me = argv[0];
	if (me == NULL) { me = getenv("_"); }
	if (me == 0) { fprintf(stderr, "E: neither argv[0] nor $_ works."); exit(1); }

	ret = chkenv(argc);
	stte_0();
	 key(pswd, pswd_z);
	arc4(msg1, msg1_z);
	arc4(date, date_z);
	if (date[0] && (atoll(date)<time(NULL)))
		return msg1;
	arc4(shll, shll_z);
	arc4(inlo, inlo_z);
	arc4(xecc, xecc_z);
	arc4(lsto, lsto_z);
	arc4(tst1, tst1_z);
	 key(tst1, tst1_z);
	arc4(chk1, chk1_z);
	if ((chk1_z != tst1_z) || memcmp(tst1, chk1, tst1_z))
		return tst1;
	arc4(msg2, msg2_z);
	if (ret < 0)
		return msg2;
	varg = (char **)calloc(argc + 10, sizeof(char *));
	if (!varg)
		return 0;
	if (ret) {
		arc4(rlax, rlax_z);
		if (!rlax[0] && key_with_file(shll))
			return shll;
		arc4(opts, opts_z);
#if HARDENING
	    arc4_hardrun(text, text_z);
	    exit(0);
       /* Seccomp Sandboxing - Start */
       seccomp_hardening();
#endif
		arc4(text, text_z);
		arc4(tst2, tst2_z);
		 key(tst2, tst2_z);
		arc4(chk2, chk2_z);
		if ((chk2_z != tst2_z) || memcmp(tst2, chk2, tst2_z))
			return tst2;
		/* Prepend hide_z spaces to script text to hide it. */
		scrpt = malloc(hide_z + text_z);
		if (!scrpt)
			return 0;
		memset(scrpt, (int) ' ', hide_z);
		memcpy(&scrpt[hide_z], text, text_z);
	} else {			/* Reexecute */
		if (*xecc) {
			scrpt = malloc(512);
			if (!scrpt)
				return 0;
			sprintf(scrpt, xecc, me);
		} else {
			scrpt = me;
		}
	}
	j = 0;
#if BUSYBOXON
	varg[j++] = "busybox";
	varg[j++] = "sh";
#else
	varg[j++] = argv[0];		/* My own name at execution */
#endif
	if (ret && *opts)
		varg[j++] = opts;	/* Options on 1st line of code */
	if (*inlo)
		varg[j++] = inlo;	/* Option introducing inline code */
	varg[j++] = scrpt;		/* The script itself */
	if (*lsto)
		varg[j++] = lsto;	/* Option meaning last option */
	i = (ret > 1) ? ret : 0;	/* Args numbering correction */
	while (i < argc)
		varg[j++] = argv[i++];	/* Main run-time arguments */
	varg[j] = 0;			/* NULL terminated array */
#if DEBUGEXEC
	debugexec(shll, j, varg);
#endif
	execvp(shll, varg);
	return shll;
}

int main(int argc, char ** argv)
{
#if SETUID
   setuid(0);
#endif
#if DEBUGEXEC
	debugexec("main", argc, argv);
#endif
#if HARDENING
	hardening();
#endif
#if !TRACEABLE
	untraceable(argv[0]);
#endif
	argv[1] = xsh(argc, argv);
	fprintf(stderr, "%s%s%s: %s\n", argv[0],
		errno ? ": " : "",
		errno ? strerror(errno) : "",
		argv[1] ? argv[1] : "<null>"
	);
	return 1;
}
