#if 0
	shc Version 4.0.1, Generic Shell Script Compiler
	GNU GPL Version 3 Md Jahidul Hamid <jahidulhamid@yahoo.com>

	shc -f menu 
#endif

static  char data [] = 
#define      tst1_z	22
#define      tst1	((&data[2]))
	"\165\300\023\007\200\372\065\152\351\225\332\302\174\152\202\022"
	"\331\152\137\313\153\344\145\021\124"
#define      msg2_z	19
#define      msg2	((&data[29]))
	"\307\255\362\363\360\113\223\314\212\055\037\220\111\131\210\365"
	"\306\261\014\331\263\255\320\045\006"
#define      rlax_z	1
#define      rlax	((&data[50]))
	"\007"
#define      date_z	1
#define      date	((&data[51]))
	"\353"
#define      chk2_z	19
#define      chk2	((&data[56]))
	"\210\140\124\052\107\224\105\175\374\060\361\134\330\235\164\027"
	"\273\363\240\113\371\345\116\272\072\013\066"
#define      opts_z	1
#define      opts	((&data[79]))
	"\201"
#define      xecc_z	15
#define      xecc	((&data[82]))
	"\141\007\216\156\341\007\051\207\274\212\052\136\321\072\203\363"
	"\021\030"
#define      pswd_z	256
#define      pswd	((&data[161]))
	"\065\000\300\363\070\361\161\276\350\112\240\160\253\364\233\145"
	"\057\246\233\324\353\107\072\204\231\234\214\262\253\206\276\341"
	"\207\176\325\300\160\106\176\130\220\036\311\073\023\144\240\102"
	"\013\074\027\367\204\121\174\035\355\010\320\231\216\216\172\017"
	"\051\212\010\116\274\117\005\043\103\341\206\342\324\274\247\055"
	"\254\027\345\053\022\070\264\223\063\117\176\350\220\154\370\271"
	"\366\001\010\263\120\016\326\224\357\135\167\304\031\037\362\306"
	"\066\327\361\110\020\246\334\103\365\133\054\206\310\045\100\276"
	"\046\111\161\167\127\110\014\107\245\203\014\276\242\376\205\331"
	"\325\166\042\346\034\377\051\022\133\126\230\043\173\330\342\241"
	"\041\123\030\171\233\045\300\101\250\315\000\113\313\205\044\241"
	"\374\107\207\030\107\261\052\242\007\303\305\202\233\247\043\274"
	"\373\074\066\227\141\367\330\012\304\331\125\217\136\172\061\132"
	"\301\270\163\010\151\236\253\160\141\161\362\374\031\026\271\024"
	"\123\360\254\265\347\205\277\253\136\025\073\274\217\154\027\121"
	"\044\212\132\216\050\005\376\212\166\361\206\217\010\100\244\134"
	"\060\121\021\030\327\321\303\065\346\376\362\165\152\011\306\217"
	"\224\040\035\275\046\034\107\234\016\316\054\026\016\321\163\077"
	"\042\204\127\371\125\033\057\073\031\042\261\204\054\170\023\300"
	"\230\061\175\276\115\304\133\133\222\210\162\241\131\345\341\025"
	"\015\117"
#define      text_z	2476
#define      text	((&data[725]))
	"\124\326\046\163\240\141\206\005\002\311\021\077\341\011\303\062"
	"\205\341\040\215\261\272\034\100\065\062\116\205\010\314\033\134"
	"\243\101\317\103\243\126\111\246\040\132\346\001\143\251\064\351"
	"\213\125\166\075\017\223\176\104\305\314\311\315\230\345\051\073"
	"\047\371\177\313\120\310\161\160\043\127\162\207\001\246\160\215"
	"\373\347\312\013\172\110\120\077\025\032\015\255\377\067\351\046"
	"\060\150\361\200\061\143\361\124\273\143\333\274\011\113\111\005"
	"\062\024\021\255\135\141\354\162\173\372\040\172\061\012\241\141"
	"\162\222\342\244\366\323\370\261\066\324\155\100\040\267\106\123"
	"\314\127\000\052\270\355\235\064\347\275\257\030\310\120\171\072"
	"\343\134\337\331\057\327\212\146\254\370\246\314\260\354\037\174"
	"\104\040\247\375\015\104\061\364\002\341\014\312\061\206\005\025"
	"\343\344\356\022\274\171\171\150\162\037\065\042\014\125\237\120"
	"\165\106\116\202\213\177\167\215\140\204\130\222\013\135\250\356"
	"\102\227\001\376\020\172\147\203\232\234\245\246\361\105\367\147"
	"\214\105\352\027\305\141\245\046\345\375\271\361\133\141\337\235"
	"\370\340\233\011\132\002\214\365\237\062\233\221\167\223\370\004"
	"\331\343\033\237\104\301\305\052\276\177\033\032\340\373\267\330"
	"\333\122\342\066\125\156\053\365\240\307\206\030\133\177\034\065"
	"\142\004\010\245\053\340\252\316\174\032\231\150\303\371\272\336"
	"\111\076\367\063\267\361\024\127\363\263\367\041\367\034\262\211"
	"\053\307\017\110\135\167\026\107\145\227\224\116\135\326\365\154"
	"\346\300\211\025\365\307\145\255\154\201\334\207\041\312\056\350"
	"\073\015\305\333\113\062\341\114\066\005\151\211\247\344\361\357"
	"\043\012\070\351\146\334\353\054\067\355\277\363\377\317\334\126"
	"\127\236\075\147\231\231\170\213\033\116\110\346\351\343\155\232"
	"\141\033\025\010\273\136\122\151\172\114\074\277\271\126\142\351"
	"\140\244\234\342\027\257\076\107\337\147\117\300\273\132\014\320"
	"\332\374\311\270\346\343\127\334\066\257\207\243\033\331\054\043"
	"\350\005\365\255\364\147\342\353\237\074\337\077\063\230\175\206"
	"\170\330\105\243\303\010\342\364\355\136\351\325\337\160\223\242"
	"\004\157\064\254\005\373\247\000\226\207\343\263\332\177\127\223"
	"\263\034\244\127\254\020\011\271\046\261\360\267\211\042\336\305"
	"\260\126\255\117\277\006\106\364\163\343\263\316\154\061\373\174"
	"\050\370\362\031\173\062\260\367\212\143\152\050\064\012\157\234"
	"\300\107\375\047\042\123\044\322\104\237\130\154\067\016\001\150"
	"\001\107\105\215\177\377\130\331\130\240\011\061\143\130\064\371"
	"\245\206\166\314\100\315\355\276\351\352\370\142\100\270\033\140"
	"\323\206\360\371\113\056\325\226\133\255\103\326\067\026\245\363"
	"\377\137\365\055\133\003\026\302\325\006\305\307\164\030\002\112"
	"\275\252\114\203\144\171\020\020\140\067\234\005\141\373\214\065"
	"\004\205\153\231\041\357\077\167\002\114\235\267\106\217\017\344"
	"\320\126\162\307\362\120\120\271\356\116\230\112\210\042\102\036"
	"\123\125\125\232\027\075\225\252\136\004\140\074\305\005\116\051"
	"\146\007\057\162\264\236\350\101\107\357\144\267\057\222\311\047"
	"\172\374\365\333\023\074\325\240\240\160\205\030\016\041\156\375"
	"\052\014\350\303\000\056\265\205\033\237\143\141\000\143\373\160"
	"\111\375\156\244\310\261\251\352\361\307\314\061\060\246\016\371"
	"\370\077\075\034\216\203\173\105\265\364\014\223\203\275\236\121"
	"\007\103\334\070\335\053\127\031\026\277\333\116\033\151\224\234"
	"\346\101\022\141\372\371\372\305\161\250\040\023\334\132\277\055"
	"\026\021\070\025\223\043\123\220\206\130\156\057\171\053\324\127"
	"\111\362\224\036\031\144\254\331\065\266\033\116\245\064\044\353"
	"\052\261\062\126\004\317\344\205\320\070\160\251\375\230\354\162"
	"\126\011\230\303\122\374\364\024\113\030\006\071\164\131\044\012"
	"\170\376\156\313\242\143\006\306\337\276\257\160\107\217\156\272"
	"\213\072\146\212\353\150\262\144\102\335\206\262\021\263\032\127"
	"\131\114\320\366\070\043\162\156\246\307\154\114\046\076\347\052"
	"\175\032\016\364\127\356\310\051\274\151\035\244\174\152\110\170"
	"\167\257\330\247\273\243\047\310\210\130\302\341\157\036\141\150"
	"\136\043\373\233\275\044\163\003\125\053\125\040\365\076\361\321"
	"\245\033\353\056\125\066\210\126\260\317\204\047\011\172\230\007"
	"\375\227\322\123\013\260\113\234\031\002\131\033\023\027\030\320"
	"\172\013\121\041\035\361\132\021\306\070\336\105\245\023\076\326"
	"\376\045\272\023\310\246\144\325\103\377\024\314\033\373\303\076"
	"\310\241\253\113\265\332\341\070\232\127\003\066\335\034\334\360"
	"\143\045\266\151\136\114\117\150\123\077\355\276\204\276\363\255"
	"\111\052\214\053\047\263\105\257\376\101\275\065\264\122\002\362"
	"\130\370\147\371\351\255\135\100\027\006\054\314\236\103\277\220"
	"\025\260\031\324\144\271\330\143\050\074\020\367\112\014\020\310"
	"\116\215\177\112\124\007\305\342\367\370\145\145\001\303\233\007"
	"\335\025\162\310\264\174\167\257\262\337\255\301\254\133\016\253"
	"\221\302\172\017\317\353\316\002\141\346\320\146\206\004\312\147"
	"\274\312\173\056\024\250\223\257\230\260\307\105\046\115\140\364"
	"\303\030\123\103\234\070\065\076\373\335\230\155\130\361\236\106"
	"\252\226\323\130\211\223\345\252\362\225\307\100\153\151\132\301"
	"\170\163\014\370\007\342\236\044\371\076\172\151\107\322\030\052"
	"\227\123\131\046\325\224\032\177\012\316\323\232\333\075\067\011"
	"\073\001\241\002\215\275\021\255\163\035\277\012\341\145\335\060"
	"\242\067\352\015\270\206\237\123\366\372\276\052\145\145\222\352"
	"\371\015\264\324\045\144\243\065\346\110\011\115\172\115\101\203"
	"\240\300\053\117\204\305\320\257\040\150\113\354\000\047\300\363"
	"\222\264\015\012\125\315\211\116\374\217\034\003\012\234\305\320"
	"\276\056\311\235\117\005\073\344\172\242\212\310\137\375\213\321"
	"\064\145\031\040\036\302\201\223\333\141\234\252\022\102\204\127"
	"\257\020\321\322\075\021\261\272\101\040\157\170\323\246\162\251"
	"\227\271\153\062\161\327\013\077\032\277\250\016\166\140\236\333"
	"\356\003\367\025\243\200\076\003\072\116\271\273\344\277\334\132"
	"\020\355\251\223\376\202\014\056\050\376\254\210\362\055\061\351"
	"\266\364\055\065\316\174\255\361\121\334\252\036\276\326\216\141"
	"\001\120\144\044\367\221\136\077\150\167\333\015\332\124\145\330"
	"\360\272\101\135\152\300\271\143\363\137\075\132\347\311\350\234"
	"\247\212\272\137\354\167\342\345\003\162\073\035\242\067\274\071"
	"\300\137\302\056\364\344\062\273\107\352\043\365\123\025\227\235"
	"\223\344\347\220\100\377\247\173\106\220\315\007\274\242\176\265"
	"\052\056\325\032\253\161\373\157\322\073\150\230\041\060\024\230"
	"\306\276\010\176\340\224\107\111\146\364\055\222\375\016\172\264"
	"\352\132\054\113\230\073\020\312\006\354\343\123\245\241\143\053"
	"\243\204\022\374\137\216\254\026\202\173\121\060\256\253\027\001"
	"\040\050\044\337\265\007\307\166\145\137\373\067\177\123\013\276"
	"\231\323\073\115\275\035\112\031\371\143\044\352\224\211\221\201"
	"\232\140\127\312\056\275\164\313\122\306\236\153\362\301\206\015"
	"\014\065\120\324\252\241\024\345\177\102\037\056\142\164\303\271"
	"\327\166\123\030\347\225\234\144\012\341\020\220\364\246\076\365"
	"\273\267\252\243\060\117\341\037\047\345\340\275\045\140\346\143"
	"\100\221\211\050\123\005\134\147\164\147\010\243\251\341\243\037"
	"\006\014\374\304\366\327\061\145\251\072\142\136\172\047\207\335"
	"\006\212\207\033\340\277\257\313\246\306\214\043\304\174\105\067"
	"\140\015\002\134\113\367\060\265\140\042\126\134\123\351\132\350"
	"\230\046\376\150\042\376\107\130\030\275\147\063\326\354\070\274"
	"\213\330\337\146\062\107\247\330\011\303\020\351\064\312\046\221"
	"\255\021\347\216\076\307\100\202\120\354\363\212\176\117\242\352"
	"\202\265\330\165\233\100\102\347\316\024\254\140\131\320\031\357"
	"\371\334\136\341\257\067\140\212\251\373\031\211\235\153\025\173"
	"\316\307\264\011\346\271\005\220\154\324\012\047\237\075\026\242"
	"\321\177\201\170\342\226\361\017\354\121\175\373\100\010\165\334"
	"\223\277\010\262\222\305\311\313\157\104\326\077\061\247\266\373"
	"\042\350\331\362\330\216\157\173\046\112\266\273\010\245\373\200"
	"\323\134\336\353\074\263\114\240\214\107\304\076\376\330\126\374"
	"\113\130\326\357\055\247\070\044\156\374\012\054\317\361\064\227"
	"\311\073\027\015\355\236\341\030\062\001\250\255\231\070\310\016"
	"\240\302\277\103\224\035\332\034\324\014\136\332\052\206\320\365"
	"\034\374\177\106\276\300\270\354\145\370\023\335\300\126\165\156"
	"\356\162\104\367\317\075\076\377\305\013\333\064\366\042\210\071"
	"\142\053\326\275\266\322\050\054\067\170\241\026\043\374\025\223"
	"\301\226\323\247\231\365\347\202\271\017\300\312\352\077\261\051"
	"\064\162\140\141\004\023\040\174\351\145\247\156\070\021\134\103"
	"\247\370\360\366\023\132\233\112\074\376\307\035\035\026\367\142"
	"\123\272\051\061\110\366\373\341\200\347\003\130\113\262\115\051"
	"\373\340\144\032\224\311\275\261\241\330\161\101\032\255\252\052"
	"\277\100\064\142\115\261\215\315\160\035\020\246\272\330\371\041"
	"\075\225\016\177\331\340\337\310\357\131\340\347\104\214\241\034"
	"\126\360\136\260\313\362\063\123\160\032\152\146\166\126\133\365"
	"\350\262\071\036\223\334\203\361\176\223\252\364\126\267\013\377"
	"\275\231\106\023\130\126\144\111\214\277\002\165\356\305\365\227"
	"\175\362\040\163\336\132\211\143\311\003\020\116\221\047\016\312"
	"\254\301\357\177\325\010\325\072\317\046\120\342\045\171\250\121"
	"\002\165\203\000\314\031\010\261\121\314\061\177\335\207\146\016"
	"\213\012\140\132\134\150\205\155\236\141\300\213\341\147\107\210"
	"\212\067\012\226\307\164\334\276\373\047\213\161\005\150\046\147"
	"\273\175\111\073\361\203\312\047\257\312\240\352\077\312\230\204"
	"\147\375\320\005\340\022\273\366\336\211\114\005\370\170\363\016"
	"\063\111\173\046\235\122\077\220\226\170\300\276\120\062\231\146"
	"\002\251\145\353\236\267\000\305\051\227\330\046\371\261\247\372"
	"\055\004\140\217\337\025\001\036\007\221\113\155\222\242\314\324"
	"\114\222\136\247\376\261\223\375\121\152\361\067\074\274\365\316"
	"\356\233\155\274\056\343\172\253\023\057\154\313\047\003\247\064"
	"\112\277\105\370\061\327\225\331\043\026\021\304\272\172\145\270"
	"\000\233\375\103\237\152\306\177\064\052\151\113\247\362\307\362"
	"\055\116\226\323\311\345\333\203\111\030\100\174\121\012\057\320"
	"\256\333\314\066\323\327\376\117\221\126\260\367\103\114\124\062"
	"\153\356\362\332\200\335\055\310\212\132\225\177\147\245\260\362"
	"\261\375\203\323\034\100\033\127\375\070\322\172\117\304\147\166"
	"\114\346\341\055\314\010\320\250\304\050\134\020\111\232\211\225"
	"\252\270\241\362\162\334\015\006\031\011\061\232\360\064\313\012"
	"\346\134\066\033\216\333\316\062\350\223\126\000\063\134\030\242"
	"\242\167\365\040\256\275\073\154\155\211\302\151\116\032\150\246"
	"\376\203\011\077\071\164\057\147\020\326\122\060\133\150\013\234"
	"\107\133\315\335\161\242\012\254\264\002\213\175\237\375\214\212"
	"\062\012\044\172\241\155\130\034\335\275\214\171\326\004\317\000"
	"\125\225\026\305\006\246\112\347\077\204\154\343\046\153\172\327"
	"\050\052\163\216\001\341\266\270\252\141\347\376\331\024\051\054"
	"\021\104\110\130\222\055\247\147\022\010\115\305\000\204\033\267"
	"\132\307\166\336\044\006\364\301\147\363\003\251\105\073\353\357"
	"\162\174\000\364\355\044\102\261\060\114\135\253\131\211\176\176"
	"\106\244\263\311\033\120\064\213\241\043\263\362\231\112\306\351"
	"\160\321\242\312\146\055\030\270\276\170\242\152\342\052\026\007"
	"\127\254\024\006\334\236\225\305\315\357\342\226\323\331\205\100"
	"\352\272\336\144\024\271\116\200\041\223\056\213\303\155\120\134"
	"\153\245\153\060\004\253\061\254\016\335\270\375\150\122\252\250"
	"\173\207\144\004\301\314\145\162\336\167\253\055\026\036\252\033"
	"\117\075\335\244\306\364\207\370\250\042\337\012\050\222\240\064"
	"\212\246\340\073\370\220\135\240\157\156\040\316\304\233\156\356"
	"\327\212\342\036\251\140\063\370\136\257\355\071\216\070\324\247"
	"\371\232\322\270\031\355\322\372\350\211\323\304\334\265\373\062"
	"\043\047\047\304\357\256\334\112\056\371\177\221\061\124\070\053"
	"\356\012\343\010\370\266\002\341\100\325\246\034\213\241\117\257"
	"\311\167\163\270\046\120\002\124\111\202\345\173\326\036\246\305"
	"\051\212\315\042\101\320\004\201\246\252\236\061\114\355\340\025"
	"\144\124\316\213\244\320\337\356\123\305\151\052\344\020\357\016"
	"\233\275\060\334\216\064\135\064\337\373\145\054\351\106\102\116"
	"\232\020\331\077\341\271\055\064\177\227\137\143\250\117\161\104"
	"\014\242\040\232\327\176\317\267\172\065\343\144\173\045\262\026"
	"\065\214\125\027\105\203\113\304\033\253\050\304\372\232\010\006"
	"\074\051\241\023\247\161\312\042\246\256\206\042\323\071\070\011"
	"\305\216\041\013\022\155\320\055\030\370\361\022\223\372\031\317"
	"\043\273\343\313\054\256\355\322\135\164\365\061\255\056\072\163"
	"\274\134\176\317\311\117\375\341\110\357\363\333\351\014\253\014"
	"\310\217\330\364\075\305\307\232\072\274\313\350\352\006\133\247"
	"\142\332\167\054\051\164\015\162\143\001\115\115\015\370\132\326"
	"\207\062\312\305\370\221\140\062\116\054\033\071\062\167\341\225"
	"\121\131\301\173\315\317\355\061\320\073\177\336\064\331\264\273"
	"\013\176\201\004\020\341\067\137\015\122\231\100\311\172\326\033"
	"\323\230\226\241\147\204\323\067\277\122\026\364\053\312\260\067"
	"\110\061\074\131\023\163\270\041\305\121\142\217\314\071\252\240"
	"\321\101\101\071\305\025\161\205\147\207\171\223\121\051\313\232"
	"\133\007\363\156\172\254\220\100"
#define      msg1_z	65
#define      msg1	((&data[3580]))
	"\312\053\171\152\375\272\254\066\200\301\247\005\051\056\177\274"
	"\072\362\242\275\356\051\177\115\204\016\350\213\233\022\230\104"
	"\117\011\237\054\334\277\020\016\231\362\053\214\174\024\352\362"
	"\315\035\322\340\133\347\054\062\273\154\311\255\345\374\250\137"
	"\004\124\127\126\337\057\003\366\356\072\065\137\234\065\377\262"
	"\174\200\251\207\032\004\217\016\163\011\272\004\111\271"
#define      shll_z	10
#define      shll	((&data[3658]))
	"\326\147\130\343\352\155\005\326\223\042\042"
#define      chk1_z	22
#define      chk1	((&data[3674]))
	"\115\233\126\315\134\157\301\133\005\147\146\010\313\007\154\331"
	"\204\244\250\273\013\262\372\151\302\012\041"
#define      inlo_z	3
#define      inlo	((&data[3696]))
	"\227\116\050"
#define      lsto_z	1
#define      lsto	((&data[3699]))
	"\220"
#define      tst2_z	19
#define      tst2	((&data[3704]))
	"\310\000\131\326\361\020\145\130\161\235\006\026\033\355\062\116"
	"\122\344\231\344\031\173\006\164\143\221"/* End of data[] */;
#define      hide_z	4096
#define SETUID 0	/* Define as 1 to call setuid(0) at start of script */
#define DEBUGEXEC	0	/* Define as 1 to debug execvp calls */
#define TRACEABLE	1	/* Define as 1 to enable ptrace the executable */
#define HARDENING	0	/* Define as 1 to disable ptrace/dump the executable */
#define HARDENINGSP	0	/* Define as 1 to disable bash child process */
#define BUSYBOXON	0	/* Define as 1 to enable work with busybox */

/* rtc.c */

#include <sys/stat.h>
#include <sys/types.h>

#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>

/* 'Alleged RC4' */

static unsigned char stte[256], indx, jndx, kndx;

/*
 * Reset arc4 stte. 
 */
void stte_0(void)
{
	indx = jndx = kndx = 0;
	do {
		stte[indx] = indx;
	} while (++indx);
}

/*
 * Set key. Can be used more than once. 
 */
void key(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		do {
			tmp = stte[indx];
			kndx += tmp;
			kndx += ptr[(int)indx % len];
			stte[indx] = stte[kndx];
			stte[kndx] = tmp;
		} while (++indx);
		ptr += 256;
		len -= 256;
	}
}

/*
 * Crypt data. 
 */
void arc4(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		indx++;
		tmp = stte[indx];
		jndx += tmp;
		stte[indx] = stte[jndx];
		stte[jndx] = tmp;
		tmp += stte[indx];
		*ptr ^= stte[tmp];
		ptr++;
		len--;
	}
}

/* End of ARC4 */

#if HARDENING

#include <sys/ptrace.h>
#include <sys/wait.h>
#include <signal.h>
#include <sys/prctl.h>
#define PR_SET_PTRACER 0x59616d61

/* Seccomp Sandboxing Init */
#include <stdlib.h>
#include <stdio.h>
#include <stddef.h>
#include <string.h>
#include <unistd.h>
#include <errno.h>

#include <sys/types.h>
#include <sys/prctl.h>
#include <sys/syscall.h>
#include <sys/socket.h>

#include <linux/filter.h>
#include <linux/seccomp.h>
#include <linux/audit.h>

#define ArchField offsetof(struct seccomp_data, arch)

#define Allow(syscall) \
    BPF_JUMP(BPF_JMP+BPF_JEQ+BPF_K, SYS_##syscall, 0, 1), \
    BPF_STMT(BPF_RET+BPF_K, SECCOMP_RET_ALLOW)

struct sock_filter filter[] = {
    /* validate arch */
    BPF_STMT(BPF_LD+BPF_W+BPF_ABS, ArchField),
    BPF_JUMP( BPF_JMP+BPF_JEQ+BPF_K, AUDIT_ARCH_X86_64, 1, 0),
    BPF_STMT(BPF_RET+BPF_K, SECCOMP_RET_KILL),

    /* load syscall */
    BPF_STMT(BPF_LD+BPF_W+BPF_ABS, offsetof(struct seccomp_data, nr)),

    /* list of allowed syscalls */
    Allow(exit_group),  /* exits a processs */
    Allow(brk),         /* for malloc(), inside libc */
    Allow(mmap),        /* also for malloc() */
    Allow(munmap),      /* for free(), inside libc */

    /* and if we don't match above, die */
    BPF_STMT(BPF_RET+BPF_K, SECCOMP_RET_KILL),
};
struct sock_fprog filterprog = {
    .len = sizeof(filter)/sizeof(filter[0]),
    .filter = filter
};

/* Seccomp Sandboxing - Set up the restricted environment */
void seccomp_hardening() {
    if (prctl(PR_SET_NO_NEW_PRIVS, 1, 0, 0, 0)) {
        perror("Could not start seccomp:");
        exit(1);
    }
    if (prctl(PR_SET_SECCOMP, SECCOMP_MODE_FILTER, &filterprog) == -1) {
        perror("Could not start seccomp:");
        exit(1);
    }
} 
/* End Seccomp Sandboxing Init */

void arc4_hardrun(void * str, int len) {
    //Decode locally
    char tmp2[len];
    memcpy(tmp2, str, len);

	unsigned char tmp, * ptr = (unsigned char *)tmp2;

    int lentmp = len;

#if HARDENINGSP
    //Start tracing to protect from dump & trace
    if (ptrace(PTRACE_TRACEME, 0, 0, 0) < 0) {
        printf("Operation not permitted\n");
        kill(getpid(), SIGKILL);
        exit(1);
    }

    //Decode Bash
    while (len > 0) {
        indx++;
        tmp = stte[indx];
        jndx += tmp;
        stte[indx] = stte[jndx];
        stte[jndx] = tmp;
        tmp += stte[indx];
        *ptr ^= stte[tmp];
        ptr++;
        len--;
    }

    //Exec bash script
    system(tmp2);

    //Empty script variable
    memcpy(tmp2, str, lentmp);

    //Sinal to detach ptrace
    ptrace(PTRACE_DETACH, 0, 0, 0);
    exit(0);

    /* Seccomp Sandboxing - Start */
    seccomp_hardening();

    exit(0);
#endif /* HARDENINGSP Exit here anyway*/

    int pid, status;
    pid = fork();

    if(pid==0) {

        //Start tracing to protect from dump & trace
        if (ptrace(PTRACE_TRACEME, 0, 0, 0) < 0) {
            printf("Operation not permitted\n");
            kill(getpid(), SIGKILL);
            _exit(1);
        }

        //Decode Bash
        while (len > 0) {
            indx++;
            tmp = stte[indx];
            jndx += tmp;
            stte[indx] = stte[jndx];
            stte[jndx] = tmp;
            tmp += stte[indx];
            *ptr ^= stte[tmp];
            ptr++;
            len--;
        }

        //Exec bash script
        system(tmp2);

        //Empty script variable
        memcpy(tmp2, str, lentmp);

        //Sinal to detach ptrace
        ptrace(PTRACE_DETACH, 0, 0, 0);
        exit(0);
    }
    else {
        wait(&status);
    }

    /* Seccomp Sandboxing - Start */
    seccomp_hardening();

    exit(0);
} 
#endif /* HARDENING */

/*
 * Key with file invariants. 
 */
int key_with_file(char * file)
{
	struct stat statf[1];
	struct stat control[1];

	if (stat(file, statf) < 0)
		return -1;

	/* Turn on stable fields */
	memset(control, 0, sizeof(control));
	control->st_ino = statf->st_ino;
	control->st_dev = statf->st_dev;
	control->st_rdev = statf->st_rdev;
	control->st_uid = statf->st_uid;
	control->st_gid = statf->st_gid;
	control->st_size = statf->st_size;
	control->st_mtime = statf->st_mtime;
	control->st_ctime = statf->st_ctime;
	key(control, sizeof(control));
	return 0;
}

#if DEBUGEXEC
void debugexec(char * sh11, int argc, char ** argv)
{
	int i;
	fprintf(stderr, "shll=%s\n", sh11 ? sh11 : "<null>");
	fprintf(stderr, "argc=%d\n", argc);
	if (!argv) {
		fprintf(stderr, "argv=<null>\n");
	} else { 
		for (i = 0; i <= argc ; i++)
			fprintf(stderr, "argv[%d]=%.60s\n", i, argv[i] ? argv[i] : "<null>");
	}
}
#endif /* DEBUGEXEC */

void rmarg(char ** argv, char * arg)
{
	for (; argv && *argv && *argv != arg; argv++);
	for (; argv && *argv; argv++)
		*argv = argv[1];
}

void chkenv_end(void);

int chkenv(int argc)
{
	char buff[512];
	unsigned long mask, m;
	int l, a, c;
	char * string;
	extern char ** environ;

	mask = (unsigned long)getpid();
	stte_0();
	 key(&chkenv, (void*)&chkenv_end - (void*)&chkenv);
	 key(&data, sizeof(data));
	 key(&mask, sizeof(mask));
	arc4(&mask, sizeof(mask));
	sprintf(buff, "x%lx", mask);
	string = getenv(buff);
#if DEBUGEXEC
	fprintf(stderr, "getenv(%s)=%s\n", buff, string ? string : "<null>");
#endif
	l = strlen(buff);
	if (!string) {
		/* 1st */
		sprintf(&buff[l], "=%lu %d", mask, argc);
		putenv(strdup(buff));
		return 0;
	}
	c = sscanf(string, "%lu %d%c", &m, &a, buff);
	if (c == 2 && m == mask) {
		/* 3rd */
		rmarg(environ, &string[-l - 1]);
		return 1 + (argc - a);
	}
	return -1;
}

void chkenv_end(void){}

#if HARDENING

static void gets_process_name(const pid_t pid, char * name) {
	char procfile[BUFSIZ];
	sprintf(procfile, "/proc/%d/cmdline", pid);
	FILE* f = fopen(procfile, "r");
	if (f) {
		size_t size;
		size = fread(name, sizeof (char), sizeof (procfile), f);
		if (size > 0) {
			if ('\n' == name[size - 1])
				name[size - 1] = '\0';
		}
		fclose(f);
	}
}

void hardening() {
    prctl(PR_SET_DUMPABLE, 0);
    prctl(PR_SET_PTRACER, -1);

    int pid = getppid();
    char name[256] = {0};
    gets_process_name(pid, name);

    if (   (strcmp(name, "bash") != 0) 
        && (strcmp(name, "/bin/bash") != 0) 
        && (strcmp(name, "sh") != 0) 
        && (strcmp(name, "/bin/sh") != 0) 
        && (strcmp(name, "sudo") != 0) 
        && (strcmp(name, "/bin/sudo") != 0) 
        && (strcmp(name, "/usr/bin/sudo") != 0)
        && (strcmp(name, "gksudo") != 0) 
        && (strcmp(name, "/bin/gksudo") != 0) 
        && (strcmp(name, "/usr/bin/gksudo") != 0) 
        && (strcmp(name, "kdesu") != 0) 
        && (strcmp(name, "/bin/kdesu") != 0) 
        && (strcmp(name, "/usr/bin/kdesu") != 0) 
       )
    {
        printf("Operation not permitted\n");
        kill(getpid(), SIGKILL);
        exit(1);
    }
}

#endif /* HARDENING */

#if !TRACEABLE

#define _LINUX_SOURCE_COMPAT
#include <sys/ptrace.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <fcntl.h>
#include <signal.h>
#include <stdio.h>
#include <unistd.h>

#if !defined(PT_ATTACHEXC) /* New replacement for PT_ATTACH */
   #if !defined(PTRACE_ATTACH) && defined(PT_ATTACH)
       #define PT_ATTACHEXC	PT_ATTACH
   #elif defined(PTRACE_ATTACH)
       #define PT_ATTACHEXC PTRACE_ATTACH
   #endif
#endif

void untraceable(char * argv0)
{
	char proc[80];
	int pid, mine;

	switch(pid = fork()) {
	case  0:
		pid = getppid();
		/* For problematic SunOS ptrace */
#if defined(__FreeBSD__)
		sprintf(proc, "/proc/%d/mem", (int)pid);
#else
		sprintf(proc, "/proc/%d/as",  (int)pid);
#endif
		close(0);
		mine = !open(proc, O_RDWR|O_EXCL);
		if (!mine && errno != EBUSY)
			mine = !ptrace(PT_ATTACHEXC, pid, 0, 0);
		if (mine) {
			kill(pid, SIGCONT);
		} else {
			perror(argv0);
			kill(pid, SIGKILL);
		}
		_exit(mine);
	case -1:
		break;
	default:
		if (pid == waitpid(pid, 0, 0))
			return;
	}
	perror(argv0);
	_exit(1);
}
#endif /* !TRACEABLE */

char * xsh(int argc, char ** argv)
{
	char * scrpt;
	int ret, i, j;
	char ** varg;
	char * me = argv[0];
	if (me == NULL) { me = getenv("_"); }
	if (me == 0) { fprintf(stderr, "E: neither argv[0] nor $_ works."); exit(1); }

	ret = chkenv(argc);
	stte_0();
	 key(pswd, pswd_z);
	arc4(msg1, msg1_z);
	arc4(date, date_z);
	if (date[0] && (atoll(date)<time(NULL)))
		return msg1;
	arc4(shll, shll_z);
	arc4(inlo, inlo_z);
	arc4(xecc, xecc_z);
	arc4(lsto, lsto_z);
	arc4(tst1, tst1_z);
	 key(tst1, tst1_z);
	arc4(chk1, chk1_z);
	if ((chk1_z != tst1_z) || memcmp(tst1, chk1, tst1_z))
		return tst1;
	arc4(msg2, msg2_z);
	if (ret < 0)
		return msg2;
	varg = (char **)calloc(argc + 10, sizeof(char *));
	if (!varg)
		return 0;
	if (ret) {
		arc4(rlax, rlax_z);
		if (!rlax[0] && key_with_file(shll))
			return shll;
		arc4(opts, opts_z);
#if HARDENING
	    arc4_hardrun(text, text_z);
	    exit(0);
       /* Seccomp Sandboxing - Start */
       seccomp_hardening();
#endif
		arc4(text, text_z);
		arc4(tst2, tst2_z);
		 key(tst2, tst2_z);
		arc4(chk2, chk2_z);
		if ((chk2_z != tst2_z) || memcmp(tst2, chk2, tst2_z))
			return tst2;
		/* Prepend hide_z spaces to script text to hide it. */
		scrpt = malloc(hide_z + text_z);
		if (!scrpt)
			return 0;
		memset(scrpt, (int) ' ', hide_z);
		memcpy(&scrpt[hide_z], text, text_z);
	} else {			/* Reexecute */
		if (*xecc) {
			scrpt = malloc(512);
			if (!scrpt)
				return 0;
			sprintf(scrpt, xecc, me);
		} else {
			scrpt = me;
		}
	}
	j = 0;
#if BUSYBOXON
	varg[j++] = "busybox";
	varg[j++] = "sh";
#else
	varg[j++] = argv[0];		/* My own name at execution */
#endif
	if (ret && *opts)
		varg[j++] = opts;	/* Options on 1st line of code */
	if (*inlo)
		varg[j++] = inlo;	/* Option introducing inline code */
	varg[j++] = scrpt;		/* The script itself */
	if (*lsto)
		varg[j++] = lsto;	/* Option meaning last option */
	i = (ret > 1) ? ret : 0;	/* Args numbering correction */
	while (i < argc)
		varg[j++] = argv[i++];	/* Main run-time arguments */
	varg[j] = 0;			/* NULL terminated array */
#if DEBUGEXEC
	debugexec(shll, j, varg);
#endif
	execvp(shll, varg);
	return shll;
}

int main(int argc, char ** argv)
{
#if SETUID
   setuid(0);
#endif
#if DEBUGEXEC
	debugexec("main", argc, argv);
#endif
#if HARDENING
	hardening();
#endif
#if !TRACEABLE
	untraceable(argv[0]);
#endif
	argv[1] = xsh(argc, argv);
	fprintf(stderr, "%s%s%s: %s\n", argv[0],
		errno ? ": " : "",
		errno ? strerror(errno) : "",
		argv[1] ? argv[1] : "<null>"
	);
	return 1;
}
