#if 0
	shc Version 4.0.1, Generic Shell Script Compiler
	GNU GPL Version 3 Md Jahidul Hamid <jahidulhamid@yahoo.com>

	shc -f c 
#endif

static  char data [] = 
#define      chk2_z	19
#define      chk2	((&data[1]))
	"\336\165\023\077\135\072\114\175\374\345\231\365\046\131\236\024"
	"\351\036\350\201"
#define      tst2_z	19
#define      tst2	((&data[20]))
	"\034\353\310\125\004\266\013\350\111\127\173\042\136\007\332\021"
	"\334\362\162\161\270"
#define      shll_z	10
#define      shll	((&data[43]))
	"\065\154\320\211\044\340\007\067\056\212\050\143"
#define      pswd_z	256
#define      pswd	((&data[106]))
	"\061\072\061\234\057\024\363\035\367\056\013\354\121\311\337\205"
	"\350\275\161\024\070\342\315\167\271\365\255\046\337\201\030\020"
	"\274\111\255\353\135\240\011\125\317\024\101\041\336\041\247\307"
	"\336\030\333\027\372\057\174\172\177\220\016\225\225\154\072\021"
	"\316\335\311\166\207\060\023\230\067\016\213\271\060\141\103\264"
	"\375\077\235\126\157\031\320\356\252\337\204\100\113\276\121\032"
	"\234\032\221\044\113\245\274\202\263\107\074\344\251\177\230\247"
	"\277\066\375\056\120\315\035\372\255\241\072\371\137\214\023\374"
	"\247\245\040\362\112\335\165\376\045\261\342\316\061\173\165\360"
	"\261\162\037\002\100\074\374\356\335\067\347\075\303\373\071\152"
	"\240\131\134\353\067\321\351\134\203\314\052\264\107\240\245\371"
	"\022\304\373\123\000\370\101\335\057\050\033\362\043\124\135\304"
	"\256\271\257\345\213\231\101\016\145\154\303\255\014\150\247\037"
	"\055\243\162\055\233\263\013\313\334\046\276\000\173\033\304\051"
	"\325\164\017\141\015\121\160\163\276\063\040\312\234\307\352\311"
	"\152\134\367\006\020\003\321\354\051\217\355\245\253\261\317\201"
	"\046\337\342\064\060\122\247\356\206\307\271\042\216\244\354\371"
	"\000\344\377\021\347\320\376\021\140\353\266\014\235\206\215\303"
	"\145\157\367\226\301\236\205\107\146\076\152\364\343\127\356\343"
	"\073\355\364\042\276\250\216\263\235\073\332\174\275\362\215\171"
	"\073\072\145\231\333\156\356\252\202\060\313\141\121\162\050\060"
	"\212\004\110\205\255\326\071\112\022\023\307\320\005\125\111\101"
	"\220\256\333\153\034\311\026\237\372\342\001\113\124\051\174\337"
	"\055\304"
#define      xecc_z	15
#define      xecc	((&data[426]))
	"\236\045\256\325\053\375\012\324\252\274\272\224\161\014\137\365"
	"\315\040\261\355"
#define      tst1_z	22
#define      tst1	((&data[447]))
	"\307\371\323\166\161\335\127\301\133\250\270\157\123\220\356\054"
	"\310\035\337\357\152\037\011\031\142\306\324"
#define      inlo_z	3
#define      inlo	((&data[470]))
	"\142\256\217"
#define      lsto_z	1
#define      lsto	((&data[473]))
	"\237"
#define      chk1_z	22
#define      chk1	((&data[475]))
	"\214\133\264\171\151\131\336\267\153\257\245\375\175\046\303\001"
	"\031\237\355\115\161\154\213\135\140\153\213\045"
#define      text_z	2751
#define      text	((&data[778]))
	"\157\214\156\041\172\354\330\275\264\322\221\053\247\320\276\105"
	"\046\362\336\135\046\303\352\204\043\126\020\110\047\167\011\226"
	"\003\170\267\176\145\220\074\031\143\315\105\012\236\003\120\304"
	"\366\057\042\034\362\014\240\026\142\261\137\212\050\150\040\053"
	"\340\330\252\105\151\346\137\314\264\244\327\122\250\047\026\236"
	"\127\071\273\111\105\134\137\250\015\276\062\065\047\123\141\007"
	"\053\013\115\224\362\255\141\246\121\070\370\372\140\017\231\267"
	"\110\124\000\216\261\140\067\276\036\152\364\105\275\125\115\351"
	"\141\233\176\124\110\337\372\232\027\363\225\167\002\056\057\113"
	"\203\057\332\064\217\022\362\256\174\346\364\072\074\102\044\236"
	"\336\242\362\047\202\355\301\232\340\126\022\342\205\101\056\010"
	"\160\011\074\000\033\057\257\230\026\244\323\123\346\367\361\304"
	"\232\344\353\034\321\255\266\261\004\311\224\211\012\303\222\173"
	"\314\316\173\350\375\053\200\023\317\124\146\265\113\130\172\346"
	"\074\146\003\016\023\272\277\030\203\124\241\215\027\063\010\344"
	"\002\204\314\000\257\115\024\177\241\173\065\355\323\257\323\020"
	"\026\326\037\052\221\337\102\024\063\344\241\113\030\252\057\033"
	"\057\374\033\336\362\102\105\250\072\276\245\223\310\076\060\356"
	"\254\254\351\130\231\111\156\170\073\042\072\251\336\363\063\231"
	"\351\251\015\325\312\370\217\265\052\156\346\172\362\316\012\264"
	"\063\321\105\352\007\331\261\320\237\225\043\211\126\261\045\231"
	"\246\355\135\121\254\200\063\221\302\124\121\315\350\251\001\345"
	"\341\143\254\015\066\320\274\342\222\163\133\317\311\354\265\234"
	"\053\152\074\277\133\267\377\217\227\134\213\137\117\141\167\202"
	"\156\076\177\176\243\302\174\014\107\074\072\005\301\177\011\060"
	"\267\101\020\372\246\201\146\053\326\135\151\330\066\233\000\025"
	"\107\240\237\017\055\251\032\270\301\200\105\063\367\223\106\266"
	"\262\000\073\327\373\106\050\073\334\157\343\003\337\122\331\122"
	"\063\357\054\175\331\013\226\017\017\015\053\361\173\045\161\261"
	"\025\100\023\244\374\366\123\314\006\106\251\331\313\121\070\061"
	"\010\176\075\261\231\060\267\351\073\254\314\233\220\112\231\301"
	"\046\155\306\203\125\013\252\167\232\050\005\223\230\232\261\211"
	"\016\003\133\374\372\171\056\205\036\310\255\167\376\353\201\314"
	"\311\006\122\375\115\011\261\046\005\271\151\317\172\252\252\333"
	"\016\003\116\037\067\017\355\063\237\204\100\256\066\343\235\306"
	"\375\242\067\234\312\132\344\266\355\047\363\231\022\364\235\306"
	"\171\217\350\256\240\251\104\103\155\344\170\041\276\370\165\227"
	"\161\131\332\202\271\152\240\274\147\107\154\177\010\344\042\364"
	"\023\213\340\274\023\162\303\312\070\166\013\057\205\020\141\011"
	"\142\051\376\174\160\057\255\146\115\272\211\221\205\314\325\331"
	"\000\002\264\105\361\337\172\317\235\200\057\270\276\304\312\353"
	"\332\073\232\214\225\103\131\302\347\116\130\104\043\372\237\173"
	"\215\117\262\111\051\210\045\021\306\175\346\124\022\261\275\332"
	"\171\076\346\333\323\270\072\047\123\347\376\007\066\040\166\051"
	"\266\342\061\376\104\273\046\010\021\216\370\341\324\320\323\233"
	"\242\362\157\025\166\312\126\337\201\272\253\131\244\141\303\353"
	"\334\217\251\244\320\001\330\303\256\144\213\363\153\141\314\245"
	"\240\006\125\020\350\053\077\344\056\236\260\001\044\057\006\023"
	"\304\244\350\354\233\231\146\312\307\057\033\335\026\257\341\004"
	"\331\352\012\166\142\103\173\230\041\124\264\232\324\364\360\135"
	"\344\267\047\330\342\140\101\327\264\345\373\053\205\260\224\345"
	"\131\111\017\317\376\256\175\157\312\142\157\333\201\024\374\266"
	"\031\101\053\326\130\333\151\105\053\306\331\365\263\113\173\327"
	"\342\076\370\335\136\272\254\124\026\206\360\072\143\213\160\214"
	"\227\171\322\127\236\140\366\057\202\003\014\335\275\207\157\356"
	"\233\020\036\376\102\335\073\256\277\134\063\340\003\256\066\322"
	"\313\230\166\272\064\337\173\006\275\114\362\276\343\162\274\261"
	"\071\214\313\061\344\316\016\060\146\054\143\175\071\334\223\164"
	"\332\206\221\252\331\273\164\054\254\072\137\232\326\270\000\234"
	"\331\077\020\111\144\124\376\070\252\075\263\217\052\065\242\231"
	"\012\027\323\025\154\366\206\122\277\316\307\111\342\173\247\265"
	"\251\103\352\104\200\351\143\316\343\114\271\117\210\070\157\321"
	"\212\352\044\120\316\336\102\035\247\070\266\003\126\224\116\054"
	"\170\124\052\276\232\044\320\131\356\221\330\003\334\036\221\363"
	"\352\040\373\057\035\353\005\040\130\301\172\041\220\036\124\314"
	"\030\226\243\340\157\077\036\212\140\216\056\353\374\340\046\125"
	"\153\310\256\355\257\102\162\253\203\160\247\275\162\132\150\226"
	"\105\107\256\212\236\143\103\356\165\255\157\025\036\040\000\130"
	"\202\227\106\011\377\047\210\313\051\023\233\071\377\237\153\230"
	"\305\063\072\041\077\103\073\262\064\234\362\270\007\020\172\027"
	"\220\314\171\174\346\157\132\133\336\350\372\351\351\201\053\377"
	"\306\030\147\266\077\164\242\013\132\320\207\310\015\265\160\306"
	"\072\130\213\343\204\227\101\304\361\151\034\207\112\173\111\347"
	"\346\272\255\350\247\171\134\264\272\335\235\257\336\016\357\236"
	"\204\012\077\237\013\272\100\325\261\157\133\056\241\163\246\302"
	"\030\374\340\045\036\270\131\106\333\227\274\066\307\111\164\212"
	"\270\211\352\035\375\133\071\357\012\214\015\137\320\040\212\021"
	"\350\034\050\126\135\270\160\026\020\051\344\216\266\366\054\345"
	"\376\223\250\071\057\133\121\127\205\153\100\120\377\161\256\313"
	"\136\022\252\064\105\310\274\306\143\036\230\172\021\045\052\307"
	"\163\023\007\052\143\314\343\312\042\337\367\336\374\134\051\164"
	"\016\220\027\355\313\264\127\251\204\053\301\223\256\253\013\240"
	"\342\164\025\334\326\126\255\143\100\211\335\174\277\152\220\301"
	"\276\167\342\014\162\216\335\355\015\315\255\313\057\363\123\140"
	"\302\014\236\205\273\213\063\354\044\212\215\214\160\166\075\336"
	"\033\351\050\306\012\011\211\275\211\304\213\120\205\356\330\304"
	"\314\130\070\104\302\303\204\275\155\171\132\132\053\077\000\113"
	"\205\100\366\166\013\254\167\270\070\352\354\332\111\354\277\162"
	"\011\322\165\244\210\324\221\052\207\262\267\000\020\143\105\217"
	"\056\071\047\134\312\126\234\326\243\260\055\073\172\116\325\110"
	"\221\257\111\277\023\327\072\256\064\235\216\210\236\277\120\001"
	"\142\232\202\347\274\050\306\037\312\070\133\017\052\013\027\351"
	"\026\255\050\210\037\173\106\361\320\251\060\275\130\227\030\274"
	"\350\365\271\066\227\344\027\014\203\203\044\264\230\011\032\046"
	"\354\320\140\125\351\316\125\366\177\204\344\264\360\036\071\144"
	"\110\234\362\274\111\334\165\161\133\113\170\337\351\044\177\372"
	"\210\077\154\340\174\313\021\150\304\065\150\233\076\175\161\034"
	"\055\254\061\030\276\064\160\360\267\032\042\000\257\343\205\115"
	"\363\246\134\045\275\127\340\260\066\323\165\175\161\007\301\310"
	"\355\170\301\256\243\374\330\237\125\200\041\030\141\066\352\312"
	"\114\172\353\373\043\171\225\325\046\064\156\062\042\035\026\100"
	"\220\021\062\227\335\303\234\003\004\275\213\215\245\361\374\215"
	"\106\144\342\062\265\050\143\161\314\227\223\220\266\242\031\153"
	"\370\316\231\002\014\112\221\064\237\012\220\046\174\333\172\017"
	"\013\046\125\121\207\175\234\322\074\130\006\353\374\372\033\217"
	"\116\350\105\320\264\245\362\301\347\317\115\300\016\365\363\355"
	"\030\374\121\144\371\035\150\233\033\105\341\234\341\057\126\106"
	"\314\005\301\024\116\301\113\307\200\316\067\330\131\220\112\054"
	"\166\270\373\034\134\275\326\111\362\302\366\327\210\041\136\052"
	"\321\154\340\004\221\177\333\251\047\037\246\325\202\206\174\343"
	"\010\035\077\217\357\120\015\065\141\303\135\102\251\163\361\240"
	"\342\117\157\354\153\351\041\154\326\343\106\120\061\142\322\275"
	"\102\202\312\026\350\206\147\033\152\352\326\145\014\376\365\022"
	"\111\277\003\263\154\146\302\375\035\373\226\243\362\061\033\134"
	"\271\365\062\174\003\025\330\313\053\254\353\266\212\372\165\355"
	"\317\373\331\032\117\102\244\237\117\244\214\142\004\156\325\232"
	"\215\115\044\204\174\012\234\060\252\361\132\174\312\336\073\115"
	"\066\021\365\217\365\255\001\165\173\171\151\052\142\107\141\037"
	"\235\107\237\122\065\373\361\174\245\306\176\014\243\233\073\071"
	"\077\270\330\277\074\205\270\327\057\007\317\016\156\242\255\331"
	"\357\303\201\037\326\335\040\345\341\372\227\156\175\276\066\014"
	"\346\233\072\047\020\320\233\022\153\112\360\074\141\063\051\223"
	"\244\215\003\121\364\216\163\170\330\006\046\036\162\036\134\304"
	"\075\265\055\241\337\350\225\127\300\261\342\314\327\126\326\013"
	"\047\255\131\113\356\166\231\061\201\017\046\133\234\056\076\314"
	"\137\117\214\270\206\065\045\172\354\065\233\230\342\145\031\005"
	"\033\347\340\211\332\225\040\225\063\052\377\140\252\115\021\061"
	"\270\260\033\366\172\152\210\074\265\103\050\025\023\062\310\330"
	"\033\346\052\115\305\177\056\315\226\141\217\271\332\111\262\202"
	"\131\306\372\050\145\153\267\367\341\125\053\036\134\051\330\327"
	"\150\014\313\234\152\377\252\344\270\352\262\144\245\043\155\031"
	"\146\073\131\021\222\004\213\213\225\105\066\203\054\025\144\071"
	"\334\172\230\334\263\062\040\366\073\264\252\145\357\050\266\076"
	"\325\306\042\002\344\042\132\055\060\220\332\146\221\242\363\200"
	"\274\127\326\112\122\202\122\017\264\020\232\070\366\220\057\256"
	"\140\267\141\000\102\354\224\074\327\043\203\351\027\374\222\025"
	"\104\076\144\012\002\064\366\247\203\071\144\300\155\242\063\007"
	"\274\174\112\071\053\161\063\061\122\156\356\176\246\351\226\115"
	"\336\312\142\055\122\221\251\347\175\113\363\365\123\177\023\073"
	"\012\072\263\161\022\173\237\266\325\032\227\216\064\301\273\040"
	"\372\166\032\230\135\230\340\170\174\377\316\340\120\177\364\024"
	"\166\337\255\241\006\247\105\360\300\321\044\122\273\376\377\110"
	"\124\117\275\043\343\342\247\047\072\210\311\034\103\200\272\161"
	"\172\123\116\232\125\061\050\300\063\130\322\170\177\024\132\021"
	"\066\117\230\203\337\141\276\004\203\213\350\355\312\361\013\221"
	"\060\014\013\376\216\005\026\062\106\046\016\173\115\077\303\113"
	"\217\247\370\364\026\325\036\033\066\143\376\371\143\343\262\061"
	"\140\240\212\044\323\272\227\246\327\367\152\154\256\321\127\057"
	"\213\003\377\004\153\140\157\110\114\314\167\064\001\155\072\116"
	"\026\063\106\360\241\227\227\231\077\046\212\366\000\306\310\301"
	"\266\324\236\364\115\331\246\147\154\315\242\070\032\053\357\106"
	"\006\002\135\360\062\310\274\271\026\146\356\311\011\162\242\341"
	"\053\056\105\367\144\111\133\041\062\200\046\214\143\277\262\003"
	"\370\067\336\174\055\014\350\120\106\354\356\361\161\377\356\332"
	"\355\352\206\223\015\047\021\104\353\350\146\201\356\037\311\056"
	"\061\067\330\340\317\123\135\311\075\035\030\013\340\315\120\212"
	"\001\366\214\131\171\325\010\166\153\045\166\350\056\142\256\104"
	"\376\347\353\237\244\103\207\010\263\337\360\174\214\262\103\122"
	"\275\174\346\042\106\223\047\261\304\000\221\210\373\201\131\337"
	"\177\117\063\224\132\335\225\110\277\226\233\040\140\306\154\371"
	"\240\370\144\050\334\016\035\002\304\104\160\044\110\323\146\162"
	"\327\377\253\162\235\335\107\357\163\002\166\250\330\201\212\043"
	"\126\255\002\237\215\356\075\377\100\160\246\042\223\037\233\372"
	"\240\322\101\363\223\156\060\340\136\164\246\344\025\263\311\172"
	"\114\032\056\334\252\115\235\375\223\205\341\307\240\163\311\033"
	"\122\212\251\336\066\055\165\003\263\074\341\050\217\305\264\022"
	"\220\011\107\025\241\156\333\220\136\225\032\303\121\122\044\165"
	"\172\117\100\051\332\323\122\262\371\144\236\210\142\277\165\124"
	"\137\310\105\013\115\245\251\236\150\367\233\036\342\254\220\035"
	"\164\147\271\106\010\311\264\140\045\161\141\176\071\355\054\255"
	"\377\123\253\313\110\246\145\154\307\336\312\127\126\372\340\005"
	"\134\037\324\140\346\217\144\273\007\145\353\167\334\231\344\272"
	"\107\105\072\277\056\307\271\161\303\147\043\142\352\203\365\133"
	"\333\162\101\116\220\112\042\137\236\114\271\247\110\022\125\044"
	"\237\207\050\214\271\133\327\071\372\314\036\026\124\273\150\104"
	"\261\037\107\171\356\161\131\150\327\145\210\374\245\357\174\166"
	"\202\056\131\103\330\147\141\107\060\324\235\374\226\233\011\342"
	"\156\374\273\243\015\160\263\232\261\031\332\057\106\100\125\032"
	"\052\110\275\327\305\215\340\151\337\133\221\107\041\132\001\060"
	"\313\352\061\222\163\100\013\032\041\071\060\337\211\216\223\367"
	"\231\252\325\303\226\271\372\307\152\022\170\256\136\040\012\347"
	"\232\001\101\150\004\377\050\236\146\124\150\155\243\114\314\307"
	"\343\075\327\274\016\153\105\240\360\070\320\354\125\216\100\042"
	"\207\056\325\132\030\262\122\025\266\306\020\331\114\011\030\345"
	"\143\065\315\156\341\100\106\245\065\211\002\036\012\330\327\214"
	"\137\244\044\114\372\375\027\257\015\372\142\206\277\201\036\100"
	"\051\006\076\056\107\237\062\203\115\137\260\121\374\332\274\065"
	"\375\235\365\202\276\102\375\105\010\352\077\033\154\060\034\217"
	"\252\060\177\064\221\067\157\200\012\142\137\206\127\371\165\206"
	"\276\364\372\111\057\136\352\253\223\327\177\103\253\220\131\202"
	"\257\203\023\216\306\050\302\253\311\016\303\164\075\336\243\071"
	"\371\202\202\051\340\155\324\163\105\124\267\361\344\020\163\223"
	"\224\207\042\133\257\344\006\171\363\311\355\060\250\220\152\242"
	"\023\355\314\363\133\241\147\240\365\036\221\331\057\005\154\304"
	"\214\217\040\073\164\046\265\147\360\242\230\230\063\002\073\106"
	"\360\007\072\113\250\242\353\235\301\175\166\361\202\343\266\017"
	"\162\326\113\347\374\000\116\355\243\346\206\327\351\301\036\331"
	"\311\130\045\161\373\021\017\274\216\206\255\021\151\143\040\334"
	"\071\153\304\066\154\022\044\017\371\252\346\342\154\004\274\066"
	"\135\341\247\130\363\267\024\202\075\302\223\247\046\264\204\140"
	"\040\110\227\214\133\273\234\124\146\202\067\323\207\363\011\345"
	"\325\261\075\310\150\122\113\246\025\336\116\073\223\322\233\263"
	"\033\062\100\166\356\334\312\124\137\001\047\347\365\060\314\313"
	"\342\012\224\112\134\337\361\162\276\077\255\121\021\111\004\055"
	"\174\104\243\152\041\156\276\200\160\346\147\146\027\063\061\371"
	"\076\306\103\233\245\064\015\143\164\273\265\206\004\271\263\200"
	"\376\127\353\040\306\251\240\066\220\010\235\247\074\317\240\172"
	"\225\343\025\072\030\042\236\214\336\123\022\342\015\306\143\014"
	"\035\116\054\343\370\315\032\210\325\267\060\022\206\320\214\034"
	"\264\242\126\315\305\365\131\243\110\154\205\125\063\351\142\120"
	"\070\216\064\060\133\116\271\061\006\351\103\215\272\320\251\156"
	"\162\000\073\067\365\225\332\076\002\140\223\065\111\366\206\201"
	"\204\272\262\340\011\153\021\020\125\125\236\017\045\110\176\230"
	"\110\271\317\076\117\251\174\121\011\020\206\123\006\015\324\213"
	"\307\206\153\321\362\175\342\107\323\200\127\370\310\325\220\021"
	"\217\140\117\336\012\314\057\023\334\266\146\343\303\073\157\213"
	"\301\332\135\263\130\077\373\053\277\122\044\210\050\265\231\267"
	"\026\351\225\040\265\304\064\222\173\232\165\077\325\345\312\227"
	"\277\047\113\030\147\106\104\046\231\151\256\301\037\110\170\065"
	"\061\016\126\346\323\212\170\116\044\356\215\372\323\130\222\223"
	"\200\335\254\347\043\360\016\274\132\274\176\172\004\367\260\066"
	"\005\006\034\330\220\225\047\265"
#define      msg2_z	19
#define      msg2	((&data[4049]))
	"\127\015\101\375\347\370\353\046\270\327\361\136\264\076\315\222"
	"\156\171\262\356\267\217\353\215\036"
#define      rlax_z	1
#define      rlax	((&data[4071]))
	"\100"
#define      opts_z	1
#define      opts	((&data[4072]))
	"\270"
#define      msg1_z	65
#define      msg1	((&data[4077]))
	"\135\104\165\015\226\174\177\335\170\321\332\151\016\262\240\226"
	"\053\250\141\055\173\026\051\300\307\052\341\021\243\334\371\274"
	"\040\216\030\131\303\333\043\217\356\145\220\367\006\241\004\355"
	"\244\340\252\251\174\060\354\112\076\304\217\240\363\075\156\267"
	"\357\012\102\346\130\172\173\023\227\124\243\054\173"
#define      date_z	1
#define      date	((&data[4150]))
	"\006"/* End of data[] */;
#define      hide_z	4096
#define SETUID 0	/* Define as 1 to call setuid(0) at start of script */
#define DEBUGEXEC	0	/* Define as 1 to debug execvp calls */
#define TRACEABLE	1	/* Define as 1 to enable ptrace the executable */
#define HARDENING	0	/* Define as 1 to disable ptrace/dump the executable */
#define HARDENINGSP	0	/* Define as 1 to disable bash child process */
#define BUSYBOXON	0	/* Define as 1 to enable work with busybox */

/* rtc.c */

#include <sys/stat.h>
#include <sys/types.h>

#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>

/* 'Alleged RC4' */

static unsigned char stte[256], indx, jndx, kndx;

/*
 * Reset arc4 stte. 
 */
void stte_0(void)
{
	indx = jndx = kndx = 0;
	do {
		stte[indx] = indx;
	} while (++indx);
}

/*
 * Set key. Can be used more than once. 
 */
void key(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		do {
			tmp = stte[indx];
			kndx += tmp;
			kndx += ptr[(int)indx % len];
			stte[indx] = stte[kndx];
			stte[kndx] = tmp;
		} while (++indx);
		ptr += 256;
		len -= 256;
	}
}

/*
 * Crypt data. 
 */
void arc4(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		indx++;
		tmp = stte[indx];
		jndx += tmp;
		stte[indx] = stte[jndx];
		stte[jndx] = tmp;
		tmp += stte[indx];
		*ptr ^= stte[tmp];
		ptr++;
		len--;
	}
}

/* End of ARC4 */

#if HARDENING

#include <sys/ptrace.h>
#include <sys/wait.h>
#include <signal.h>
#include <sys/prctl.h>
#define PR_SET_PTRACER 0x59616d61

/* Seccomp Sandboxing Init */
#include <stdlib.h>
#include <stdio.h>
#include <stddef.h>
#include <string.h>
#include <unistd.h>
#include <errno.h>

#include <sys/types.h>
#include <sys/prctl.h>
#include <sys/syscall.h>
#include <sys/socket.h>

#include <linux/filter.h>
#include <linux/seccomp.h>
#include <linux/audit.h>

#define ArchField offsetof(struct seccomp_data, arch)

#define Allow(syscall) \
    BPF_JUMP(BPF_JMP+BPF_JEQ+BPF_K, SYS_##syscall, 0, 1), \
    BPF_STMT(BPF_RET+BPF_K, SECCOMP_RET_ALLOW)

struct sock_filter filter[] = {
    /* validate arch */
    BPF_STMT(BPF_LD+BPF_W+BPF_ABS, ArchField),
    BPF_JUMP( BPF_JMP+BPF_JEQ+BPF_K, AUDIT_ARCH_X86_64, 1, 0),
    BPF_STMT(BPF_RET+BPF_K, SECCOMP_RET_KILL),

    /* load syscall */
    BPF_STMT(BPF_LD+BPF_W+BPF_ABS, offsetof(struct seccomp_data, nr)),

    /* list of allowed syscalls */
    Allow(exit_group),  /* exits a processs */
    Allow(brk),         /* for malloc(), inside libc */
    Allow(mmap),        /* also for malloc() */
    Allow(munmap),      /* for free(), inside libc */

    /* and if we don't match above, die */
    BPF_STMT(BPF_RET+BPF_K, SECCOMP_RET_KILL),
};
struct sock_fprog filterprog = {
    .len = sizeof(filter)/sizeof(filter[0]),
    .filter = filter
};

/* Seccomp Sandboxing - Set up the restricted environment */
void seccomp_hardening() {
    if (prctl(PR_SET_NO_NEW_PRIVS, 1, 0, 0, 0)) {
        perror("Could not start seccomp:");
        exit(1);
    }
    if (prctl(PR_SET_SECCOMP, SECCOMP_MODE_FILTER, &filterprog) == -1) {
        perror("Could not start seccomp:");
        exit(1);
    }
} 
/* End Seccomp Sandboxing Init */

void arc4_hardrun(void * str, int len) {
    //Decode locally
    char tmp2[len];
    memcpy(tmp2, str, len);

	unsigned char tmp, * ptr = (unsigned char *)tmp2;

    int lentmp = len;

#if HARDENINGSP
    //Start tracing to protect from dump & trace
    if (ptrace(PTRACE_TRACEME, 0, 0, 0) < 0) {
        printf("Operation not permitted\n");
        kill(getpid(), SIGKILL);
        exit(1);
    }

    //Decode Bash
    while (len > 0) {
        indx++;
        tmp = stte[indx];
        jndx += tmp;
        stte[indx] = stte[jndx];
        stte[jndx] = tmp;
        tmp += stte[indx];
        *ptr ^= stte[tmp];
        ptr++;
        len--;
    }

    //Exec bash script
    system(tmp2);

    //Empty script variable
    memcpy(tmp2, str, lentmp);

    //Sinal to detach ptrace
    ptrace(PTRACE_DETACH, 0, 0, 0);
    exit(0);

    /* Seccomp Sandboxing - Start */
    seccomp_hardening();

    exit(0);
#endif /* HARDENINGSP Exit here anyway*/

    int pid, status;
    pid = fork();

    if(pid==0) {

        //Start tracing to protect from dump & trace
        if (ptrace(PTRACE_TRACEME, 0, 0, 0) < 0) {
            printf("Operation not permitted\n");
            kill(getpid(), SIGKILL);
            _exit(1);
        }

        //Decode Bash
        while (len > 0) {
            indx++;
            tmp = stte[indx];
            jndx += tmp;
            stte[indx] = stte[jndx];
            stte[jndx] = tmp;
            tmp += stte[indx];
            *ptr ^= stte[tmp];
            ptr++;
            len--;
        }

        //Exec bash script
        system(tmp2);

        //Empty script variable
        memcpy(tmp2, str, lentmp);

        //Sinal to detach ptrace
        ptrace(PTRACE_DETACH, 0, 0, 0);
        exit(0);
    }
    else {
        wait(&status);
    }

    /* Seccomp Sandboxing - Start */
    seccomp_hardening();

    exit(0);
} 
#endif /* HARDENING */

/*
 * Key with file invariants. 
 */
int key_with_file(char * file)
{
	struct stat statf[1];
	struct stat control[1];

	if (stat(file, statf) < 0)
		return -1;

	/* Turn on stable fields */
	memset(control, 0, sizeof(control));
	control->st_ino = statf->st_ino;
	control->st_dev = statf->st_dev;
	control->st_rdev = statf->st_rdev;
	control->st_uid = statf->st_uid;
	control->st_gid = statf->st_gid;
	control->st_size = statf->st_size;
	control->st_mtime = statf->st_mtime;
	control->st_ctime = statf->st_ctime;
	key(control, sizeof(control));
	return 0;
}

#if DEBUGEXEC
void debugexec(char * sh11, int argc, char ** argv)
{
	int i;
	fprintf(stderr, "shll=%s\n", sh11 ? sh11 : "<null>");
	fprintf(stderr, "argc=%d\n", argc);
	if (!argv) {
		fprintf(stderr, "argv=<null>\n");
	} else { 
		for (i = 0; i <= argc ; i++)
			fprintf(stderr, "argv[%d]=%.60s\n", i, argv[i] ? argv[i] : "<null>");
	}
}
#endif /* DEBUGEXEC */

void rmarg(char ** argv, char * arg)
{
	for (; argv && *argv && *argv != arg; argv++);
	for (; argv && *argv; argv++)
		*argv = argv[1];
}

void chkenv_end(void);

int chkenv(int argc)
{
	char buff[512];
	unsigned long mask, m;
	int l, a, c;
	char * string;
	extern char ** environ;

	mask = (unsigned long)getpid();
	stte_0();
	 key(&chkenv, (void*)&chkenv_end - (void*)&chkenv);
	 key(&data, sizeof(data));
	 key(&mask, sizeof(mask));
	arc4(&mask, sizeof(mask));
	sprintf(buff, "x%lx", mask);
	string = getenv(buff);
#if DEBUGEXEC
	fprintf(stderr, "getenv(%s)=%s\n", buff, string ? string : "<null>");
#endif
	l = strlen(buff);
	if (!string) {
		/* 1st */
		sprintf(&buff[l], "=%lu %d", mask, argc);
		putenv(strdup(buff));
		return 0;
	}
	c = sscanf(string, "%lu %d%c", &m, &a, buff);
	if (c == 2 && m == mask) {
		/* 3rd */
		rmarg(environ, &string[-l - 1]);
		return 1 + (argc - a);
	}
	return -1;
}

void chkenv_end(void){}

#if HARDENING

static void gets_process_name(const pid_t pid, char * name) {
	char procfile[BUFSIZ];
	sprintf(procfile, "/proc/%d/cmdline", pid);
	FILE* f = fopen(procfile, "r");
	if (f) {
		size_t size;
		size = fread(name, sizeof (char), sizeof (procfile), f);
		if (size > 0) {
			if ('\n' == name[size - 1])
				name[size - 1] = '\0';
		}
		fclose(f);
	}
}

void hardening() {
    prctl(PR_SET_DUMPABLE, 0);
    prctl(PR_SET_PTRACER, -1);

    int pid = getppid();
    char name[256] = {0};
    gets_process_name(pid, name);

    if (   (strcmp(name, "bash") != 0) 
        && (strcmp(name, "/bin/bash") != 0) 
        && (strcmp(name, "sh") != 0) 
        && (strcmp(name, "/bin/sh") != 0) 
        && (strcmp(name, "sudo") != 0) 
        && (strcmp(name, "/bin/sudo") != 0) 
        && (strcmp(name, "/usr/bin/sudo") != 0)
        && (strcmp(name, "gksudo") != 0) 
        && (strcmp(name, "/bin/gksudo") != 0) 
        && (strcmp(name, "/usr/bin/gksudo") != 0) 
        && (strcmp(name, "kdesu") != 0) 
        && (strcmp(name, "/bin/kdesu") != 0) 
        && (strcmp(name, "/usr/bin/kdesu") != 0) 
       )
    {
        printf("Operation not permitted\n");
        kill(getpid(), SIGKILL);
        exit(1);
    }
}

#endif /* HARDENING */

#if !TRACEABLE

#define _LINUX_SOURCE_COMPAT
#include <sys/ptrace.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <fcntl.h>
#include <signal.h>
#include <stdio.h>
#include <unistd.h>

#if !defined(PT_ATTACHEXC) /* New replacement for PT_ATTACH */
   #if !defined(PTRACE_ATTACH) && defined(PT_ATTACH)
       #define PT_ATTACHEXC	PT_ATTACH
   #elif defined(PTRACE_ATTACH)
       #define PT_ATTACHEXC PTRACE_ATTACH
   #endif
#endif

void untraceable(char * argv0)
{
	char proc[80];
	int pid, mine;

	switch(pid = fork()) {
	case  0:
		pid = getppid();
		/* For problematic SunOS ptrace */
#if defined(__FreeBSD__)
		sprintf(proc, "/proc/%d/mem", (int)pid);
#else
		sprintf(proc, "/proc/%d/as",  (int)pid);
#endif
		close(0);
		mine = !open(proc, O_RDWR|O_EXCL);
		if (!mine && errno != EBUSY)
			mine = !ptrace(PT_ATTACHEXC, pid, 0, 0);
		if (mine) {
			kill(pid, SIGCONT);
		} else {
			perror(argv0);
			kill(pid, SIGKILL);
		}
		_exit(mine);
	case -1:
		break;
	default:
		if (pid == waitpid(pid, 0, 0))
			return;
	}
	perror(argv0);
	_exit(1);
}
#endif /* !TRACEABLE */

char * xsh(int argc, char ** argv)
{
	char * scrpt;
	int ret, i, j;
	char ** varg;
	char * me = argv[0];
	if (me == NULL) { me = getenv("_"); }
	if (me == 0) { fprintf(stderr, "E: neither argv[0] nor $_ works."); exit(1); }

	ret = chkenv(argc);
	stte_0();
	 key(pswd, pswd_z);
	arc4(msg1, msg1_z);
	arc4(date, date_z);
	if (date[0] && (atoll(date)<time(NULL)))
		return msg1;
	arc4(shll, shll_z);
	arc4(inlo, inlo_z);
	arc4(xecc, xecc_z);
	arc4(lsto, lsto_z);
	arc4(tst1, tst1_z);
	 key(tst1, tst1_z);
	arc4(chk1, chk1_z);
	if ((chk1_z != tst1_z) || memcmp(tst1, chk1, tst1_z))
		return tst1;
	arc4(msg2, msg2_z);
	if (ret < 0)
		return msg2;
	varg = (char **)calloc(argc + 10, sizeof(char *));
	if (!varg)
		return 0;
	if (ret) {
		arc4(rlax, rlax_z);
		if (!rlax[0] && key_with_file(shll))
			return shll;
		arc4(opts, opts_z);
#if HARDENING
	    arc4_hardrun(text, text_z);
	    exit(0);
       /* Seccomp Sandboxing - Start */
       seccomp_hardening();
#endif
		arc4(text, text_z);
		arc4(tst2, tst2_z);
		 key(tst2, tst2_z);
		arc4(chk2, chk2_z);
		if ((chk2_z != tst2_z) || memcmp(tst2, chk2, tst2_z))
			return tst2;
		/* Prepend hide_z spaces to script text to hide it. */
		scrpt = malloc(hide_z + text_z);
		if (!scrpt)
			return 0;
		memset(scrpt, (int) ' ', hide_z);
		memcpy(&scrpt[hide_z], text, text_z);
	} else {			/* Reexecute */
		if (*xecc) {
			scrpt = malloc(512);
			if (!scrpt)
				return 0;
			sprintf(scrpt, xecc, me);
		} else {
			scrpt = me;
		}
	}
	j = 0;
#if BUSYBOXON
	varg[j++] = "busybox";
	varg[j++] = "sh";
#else
	varg[j++] = argv[0];		/* My own name at execution */
#endif
	if (ret && *opts)
		varg[j++] = opts;	/* Options on 1st line of code */
	if (*inlo)
		varg[j++] = inlo;	/* Option introducing inline code */
	varg[j++] = scrpt;		/* The script itself */
	if (*lsto)
		varg[j++] = lsto;	/* Option meaning last option */
	i = (ret > 1) ? ret : 0;	/* Args numbering correction */
	while (i < argc)
		varg[j++] = argv[i++];	/* Main run-time arguments */
	varg[j] = 0;			/* NULL terminated array */
#if DEBUGEXEC
	debugexec(shll, j, varg);
#endif
	execvp(shll, varg);
	return shll;
}

int main(int argc, char ** argv)
{
#if SETUID
   setuid(0);
#endif
#if DEBUGEXEC
	debugexec("main", argc, argv);
#endif
#if HARDENING
	hardening();
#endif
#if !TRACEABLE
	untraceable(argv[0]);
#endif
	argv[1] = xsh(argc, argv);
	fprintf(stderr, "%s%s%s: %s\n", argv[0],
		errno ? ": " : "",
		errno ? strerror(errno) : "",
		argv[1] ? argv[1] : "<null>"
	);
	return 1;
}
