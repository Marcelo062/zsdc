#if 0
	shc Version 4.0.1, Generic Shell Script Compiler
	GNU GPL Version 3 Md Jahidul Hamid <jahidulhamid@yahoo.com>

	shc -f desc 
#endif

static  char data [] = 
#define      chk2_z	19
#define      chk2	((&data[0]))
	"\167\266\134\322\064\140\163\134\057\212\133\272\345\216\075\370"
	"\071\162\053\261"
#define      msg1_z	65
#define      msg1	((&data[22]))
	"\222\271\226\215\001\246\077\240\361\251\313\172\102\077\377\330"
	"\133\257\077\120\010\162\253\376\017\060\000\217\301\055\344\332"
	"\123\217\260\044\216\011\162\124\356\327\202\365\132\231\302\056"
	"\071\111\133\055\276\172\074\161\216\362\004\167\207\303\050\104"
	"\023\117\300\054\366\033\302\341\255"
#define      msg2_z	19
#define      msg2	((&data[94]))
	"\332\033\023\266\141\120\256\041\345\034\312\122\107\275\102\230"
	"\275\112\003\013\321"
#define      shll_z	10
#define      shll	((&data[114]))
	"\160\145\066\252\276\270\140\266\065\046\324\034"
#define      tst1_z	22
#define      tst1	((&data[131]))
	"\251\072\377\235\151\175\124\130\061\103\355\005\345\346\351\264"
	"\034\067\207\047\172\126\364\275\130\301\166\102\117"
#define      chk1_z	22
#define      chk1	((&data[157]))
	"\034\036\266\363\263\311\363\266\361\173\102\001\054\210\140\136"
	"\254\317\001\152\371\374\313\317\326\023\071"
#define      rlax_z	1
#define      rlax	((&data[182]))
	"\235"
#define      inlo_z	3
#define      inlo	((&data[183]))
	"\373\113\016"
#define      pswd_z	256
#define      pswd	((&data[192]))
	"\105\013\076\142\204\060\130\222\301\164\252\256\236\271\021\100"
	"\040\063\002\333\134\156\250\251\004\235\050\077\063\301\227\076"
	"\132\316\350\340\342\100\162\244\265\035\123\123\327\144\224\367"
	"\230\227\323\365\005\174\236\012\032\307\111\115\210\341\213\343"
	"\257\163\303\222\264\066\066\152\124\211\276\053\356\122\043\206"
	"\351\366\173\357\163\032\372\215\341\104\332\152\045\146\116\325"
	"\332\021\147\217\110\236\371\234\047\267\307\026\012\353\235\364"
	"\342\030\343\125\063\336\343\024\042\276\177\110\044\315\035\377"
	"\337\204\216\047\043\210\304\113\077\213\141\111\167\376\075\131"
	"\027\041\256\112\377\221\137\042\117\337\152\164\254\210\164\214"
	"\015\003\263\060\213\170\173\312\004\334\024\173\333\121\324\362"
	"\162\202\075\162\024\234\224\144\173\377\331\050\207\115\264\224"
	"\120\150\304\334\340\100\246\344\035\272\137\370\014\064\353\177"
	"\266\050\362\313\305\206\057\100\206\011\151\015\126\035\242\247"
	"\206\147\203\147\247\052\113\304\345\253\275\362\337\250\162\226"
	"\321\144\142\226\352\221\327\160\233\100\176\362\135\040\231\344"
	"\207\035\113\057\110\227\312\056\153\311\314\324\013\033\135\160"
	"\306\172\217\234\216\311\066\203\260\151\313\340\167\345\112\274"
#define      date_z	1
#define      date	((&data[474]))
	"\010"
#define      lsto_z	1
#define      lsto	((&data[475]))
	"\370"
#define      opts_z	1
#define      opts	((&data[476]))
	"\015"
#define      text_z	2132
#define      text	((&data[994]))
	"\213\125\056\121\320\275\356\136\207\044\342\067\216\256\027\005"
	"\223\142\301\203\352\340\370\243\311\233\307\173\013\277\071\226"
	"\025\147\347\346\045\325\105\254\372\047\344\210\326\374\215\151"
	"\136\117\355\111\057\345\355\371\201\265\164\214\165\256\042\212"
	"\025\012\161\073\337\266\350\332\336\314\142\265\310\357\036\047"
	"\076\014\160\156\362\135\147\163\022\333\000\207\211\042\022\237"
	"\055\203\333\015\072\303\347\031\220\111\316\130\071\355\200\167"
	"\372\360\345\354\115\115\137\140\051\137\347\263\202\372\123\257"
	"\176\056\275\271\361\244\322\202\355\241\333\047\217\133\236\211"
	"\113\204\165\231\322\325\371\373\065\341\256\270\334\001\150\132"
	"\057\045\024\041\311\347\244\267\211\177\336\030\332\175\242\045"
	"\002\030\277\324\355\271\317\043\233\176\334\167\177\104\322\257"
	"\152\346\321\064\316\165\353\127\365\312\157\317\110\022\365\112"
	"\052\264\037\030\156\357\073\011\155\030\201\355\134\124\235\306"
	"\073\157\372\011\344\346\140\332\261\320\251\372\342\237\105\015"
	"\124\144\045\302\123\141\314\301\171\116\256\326\242\113\234\335"
	"\272\227\347\237\176\110\172\060\030\043\052\373\302\157\010\026"
	"\324\056\331\047\220\245\351\011\363\227\340\226\343\174\164\236"
	"\024\133\076\223\243\270\303\274\334\355\270\237\135\301\266\061"
	"\357\217\131\177\065\102\211\051\332\151\300\276\346\064\135\373"
	"\220\233\216\064\124\121\360\061\077\251\320\234\152\206\315\131"
	"\026\047\331\114\151\143\165\103\315\065\002\264\152\137\257\372"
	"\373\075\056\117\217\037\200\316\310\120\153\062\327\071\214\356"
	"\140\146\072\311\311\257\015\227\345\017\113\117\157\372\112\152"
	"\070\170\271\307\227\072\226\137\213\002\222\143\073\036\121\233"
	"\204\213\145\116\073\162\345\040\202\060\160\362\052\272\134\142"
	"\063\026\052\313\120\301\053\334\303\275\077\376\333\220\232\140"
	"\033\377\257\126\162\224\167\365\305\350\347\357\242\104\122\326"
	"\132\175\241\253\076\314\207\002\211\307\000\145\127\233\306\163"
	"\232\165\312\014\012\102\002\317\052\351\277\315\056\022\243\210"
	"\217\104\064\316\020\273\320\232\203\321\377\332\154\306\116\007"
	"\073\030\024\106\133\026\025\205\000\324\122\056\346\366\267\166"
	"\072\353\104\113\247\131\116\033\063\021\246\352\216\012\324\364"
	"\124\376\302\223\216\031\137\137\333\071\172\023\171\074\116\254"
	"\042\237\307\345\040\003\102\276\324\215\012\307\375\162\241\045"
	"\376\065\053\016\307\225\266\012\006\006\102\006\000\364\212\044"
	"\134\347\044\340\073\301\055\325\267\106\360\321\252\154\241\271"
	"\021\052\230\157\363\255\265\010\042\155\204\147\013\271\133\000"
	"\321\325\157\144\346\221\147\336\202\246\332\071\316\073\275\214"
	"\071\063\214\173\227\337\355\273\313\276\016\067\167\126\013\301"
	"\114\042\270\276\333\306\155\234\122\371\001\001\326\044\301\131"
	"\220\207\333\233\267\235\153\125\231\314\334\220\121\163\065\005"
	"\207\365\025\272\215\061\334\023\274\061\044\315\351\234\263\264"
	"\112\107\011\036\377\115\011\353\350\345\122\205\343\375\201\104"
	"\371\157\117\030\331\201\377\113\170\131\335\207\362\242\127\212"
	"\066\361\213\320\025\013\050\261\220\305\024\014\114\111\026\341"
	"\320\173\125\042\331\373\243\055\126\235\174\053\164\353\254\165"
	"\250\054\051\141\345\167\327\212\067\273\216\120\155\335\116\116"
	"\131\162\277\376\016\315\113\025\112\076\224\134\014\216\377\105"
	"\046\134\151\004\312\106\143\365\321\274\032\004\337\001\070\234"
	"\235\017\227\146\222\267\363\315\023\174\043\003\246\247\223\220"
	"\045\223\252\373\226\152\216\325\253\346\020\362\144\074\227\217"
	"\000\307\337\140\121\025\150\162\224\026\232\136\306\202\112\012"
	"\213\044\301\123\071\162\151\005\271\332\063\322\143\311\353\056"
	"\104\143\223\120\254\346\370\142\032\157\203\315\102\042\240\163"
	"\024\047\035\123\240\376\300\164\221\041\321\043\030\251\127\227"
	"\305\366\352\376\016\063\047\115\154\005\256\114\263\121\326\166"
	"\256\054\073\311\013\245\324\010\041\305\151\202\235\254\032\146"
	"\114\352\160\313\073\322\335\003\040\233\262\176\375\305\334\141"
	"\044\142\042\151\035\172\323\322\042\123\061\070\074\344\064\314"
	"\361\372\015\321\050\355\137\265\350\310\066\307\314\264\241\357"
	"\270\271\251\050\204\074\031\014\267\067\306\343\033\175\206\005"
	"\217\022\077\105\155\044\103\126\332\200\165\012\055\241\251\054"
	"\054\152\261\310\107\265\357\165\345\115\361\342\063\273\233\206"
	"\266\254\365\305\064\245\227\231\310\050\160\357\037\265\072\255"
	"\167\042\175\374\224\004\366\021\346\267\140\212\004\317\101\264"
	"\260\077\210\343\262\163\171\343\026\025\372\241\105\117\225\077"
	"\130\207\212\212\155\052\252\346\014\313\355\341\277\147\007\151"
	"\175\334\115\221\156\203\322\344\223\077\154\311\217\235\375\276"
	"\003\036\206\006\166\156\034\225\036\370\223\157\055\355\013\143"
	"\062\134\045\065\055\362\365\202\135\357\262\323\325\210\243\073"
	"\206\062\076\366\117\031\366\132\107\077\176\313\145\245\361\367"
	"\157\053\301\133\373\373\275\303\217\360\276\366\261\345\155\364"
	"\047\273\365\203\270\343\113\170\176\016\247\145\154\207\167\172"
	"\122\000\307\207\266\011\157\121\045\260\121\216\002\247\363\364"
	"\217\104\006\317\323\006\271\137\032\240\266\371\074\024\346\154"
	"\322\302\143\201\136\246\302\246\177\027\233\110\355\063\311\030"
	"\140\102\274\367\313\262\025\373\374\026\376\202\370\320\336\111"
	"\013\341\204\130\140\375\207\034\333\367\301\026\104\376\106\204"
	"\115\052\272\143\256\010\205\357\340\106\330\275\142\151\125\232"
	"\027\021\110\016\350\134\233\050\066\335\311\270\142\257\067\352"
	"\031\175\354\264\001\226\006\213\274\072\246\127\004\227\354\173"
	"\247\212\177\047\054\035\305\363\073\021\007\061\225\375\173\211"
	"\366\160\203\320\361\055\125\013\143\234\311\022\347\175\235\377"
	"\134\051\062\227\071\062\230\232\375\061\234\162\070\071\023\075"
	"\107\142\007\150\122\070\314\035\152\220\173\314\013\045\125\127"
	"\122\340\316\237\101\335\265\375\250\173\004\015\112\203\324\075"
	"\375\351\007\227\041\311\175\161\274\303\061\154\266\014\264\351"
	"\137\020\324\154\226\052\251\044\345\344\173\377\261\240\140\026"
	"\070\243\307\361\027\071\006\325\317\030\122\227\141\372\333\151"
	"\315\016\147\117\044\137\034\176\131\067\356\007\314\072\016\022"
	"\021\227\024\317\061\254\235\326\216\147\023\135\243\101\013\010"
	"\112\317\154\266\165\160\252\337\230\125\107\002\371\335\036\255"
	"\214\357\032\027\325\144\317\341\170\247\267\055\300\100\271\177"
	"\247\244\024\213\204\113\033\323\032\223\266\073\152\361\102\072"
	"\267\070\137\075\213\160\373\223\112\224\106\040\257\110\015\275"
	"\340\157\255\040\142\275\043\003\124\217\211\063\061\125\314\275"
	"\271\015\343\004\345\253\213\114\311\044\061\374\207\056\122\145"
	"\124\136\210\311\321\250\045\317\335\301\223\273\161\151\352\173"
	"\014\237\066\266\205\006\302\076\233\376\102\022\147\150\147\226"
	"\032\077\143\135\374\201\007\360\305\064\244\051\370\117\033\100"
	"\320\333\043\117\303\044\011\121\205\245\336\064\233\027\063\247"
	"\071\152\074\032\144\316\353\100\354\153\354\255\344\371\013\050"
	"\117\257\207\373\057\042\176\113\123\165\354\107\232\212\207\300"
	"\232\274\373\027\027\125\142\243\306\053\321\262\341\246\176\027"
	"\310\063\370\150\053\306\070\224\075\130\216\077\115\052\206\105"
	"\035\364\176\306\033\375\206\261\322\156\233\275\047\115\343\351"
	"\137\342\105\203\331\176\273\106\177\117\305\263\223\052\064\242"
	"\211\032\030\327\377\175\373\065\351\304\171\071\232\200\150\065"
	"\044\311\156\306\255\144\062\055\372\261\111\353\116\361\072\121"
	"\036\321\014\324\255\271\147\376\006\052\347\060\111\172\273\306"
	"\341\327\256\157\350\127\013\364\231\113\037\235\313\062\374\321"
	"\177\104\254\215\163\317\302\147\217\171\026\100\004\025\014\337"
	"\350\002\230\337\332\145\363\242\330\245\206\116\012\122\341\206"
	"\346\350\054\065\061\241\111\243\053\111\223\272\303\042\304\256"
	"\365\277\275\317\335\235\052\003\276\056\370\344\277\362\354\243"
	"\265\046\223\024\057\017\056\034\171\175\220\023\155\207\076\022"
	"\012\302\114\053\270\277\143\056\216\160\362\313\047\330\156\336"
	"\306\203\012\003\114\027\176\243\344\340\150\054\124\373\377\246"
	"\066\135\065\373\130\015\110\257\013\102\236\370\065\050\360\240"
	"\333\234\000\226\262\371\340\175\057\140\141\313\020\263\230\364"
	"\061\115\265\305\021\006\316\017\130\132\033\113\266\243\147\365"
	"\204\005\266\041\363\311\044\307\220\274\014\120\107\000\235\341"
	"\226\154\022\100\351\073\132\104\364\270\317\156\011\235\007\313"
	"\022\033\247\353\354\331\207\034\236\005\015\340\016\030\256\324"
	"\137\154\147\122\174\153\303\333\137\327\117\253\276\225\301\321"
	"\112\203\011\232\217\105\302\341\216\030\072\064\115\112\124\037"
	"\233\244\345\354\106\017\200\360\351\277\100\373\164\011\345\024"
	"\125\121\313\315\277\127\033\043\253\001\032\313\035\343\235\077"
	"\236\163\127\312\052\245\131\241\303\100\124\145\036\353\273\376"
	"\161\064\075\072\140\306\200\016\330\113\134\372\352\044\276\131"
	"\356\311\242\365\305\225\322\140\155\355\353\277\076\271\201\151"
	"\025\000\274\243\331\022\237\041\121\344\107\304\234\124\155\157"
	"\215\054\260\300\307\107\147\270\242\076\114\377\341\053\326\234"
	"\006\233\002\350\122\171\215\204\241\036\051\124\354\241\037\027"
	"\347\345\152\304\204\011\051\105\041\007\147\101\352\125\144\034"
	"\132\047\011\063\177\331\345\160\107\255\255\332\132\351\154\061"
	"\077\241\326\165\133\146\373\241\245\016\351\377\164\322\154\154"
	"\007\063\075\347\154\356\125\252\050\026\016\075\233\016\156\161"
	"\161\115\144\117\064\157\134\271\135\005\162\124\347\001\147\312"
	"\331\045\374\167\242\074\004\232\223\330\325\303\306\330\044\243"
	"\061\206\133\073\072\001\077\374\032\176\273\263\363\074\004\333"
	"\053\326\123\234\305\146\341\207\220\164\272\046\363\205\273\005"
	"\356\252\356\122\352\177\200\153\024\162\131\372\130\305\325\312"
	"\003\033\005\350\105\250\217\001\014\022\072\161\266\105\375\055"
	"\114\342\272\205\113\314\374\372\107\326\021\333\267\030\055\366"
	"\265\151\040\355\074\125\075\372\227\221\241\257\050\164\001\233"
	"\306\160\066\125\052\276\364\177\157\043\301\226\336\273\272\143"
	"\251\167\363\145\301\031\266\101\145\142\230\363\344\257\256\266"
	"\311\111\124\151\357\002\122\262\121\162\134\344\357\037\266\231"
	"\355\327\235\270\126\174\015\316\372\237\342\031\005\375\161\234"
	"\030\367\325\253\115\243\223\221\163\023\134\337\262\313\262\014"
	"\152\110\313\276\322\135\136\365\306\101\325\302\055\371\021\316"
	"\376\012\267\032\314\174\042\356\264\204\070\327\104\372\136\152"
	"\312\154\200\171\217\103\072\262\204\305\367\003\264\160\322\306"
	"\313\075\060\241\156\220\256\322\351\205\366\045\107\010\220\032"
	"\367\224\327\176\032\177\350\015\343\030\035\176\036\366\115\300"
	"\234\071\360\277\365\101\044\171\020\050\301\073\002\103\334\254"
	"\022\370\166\050\123\004\003\032\054\221\005\210\120\150\175\106"
	"\304\243\336\251\235\253\310\131\010\323\221\126\250\376\310\033"
	"\210\063\043\223\043\217\250\056\304\215\132\064\022\061\307\050"
	"\116\230\217\037\354\373\025\112\377\340\152\000\153\275\036\014"
	"\102\252\356\315\170\207\266\126\312\222\300\132\110\167\306\161"
	"\262\226\074\214\025\154\161\142\074\163\277\201\301\210\162\034"
	"\123\217\217\230\332\001\243\047\223\013\364\114\206\365\032\055"
	"\234\014\340\100\017\204\013\125\325\025\345\052\347\345\005\124"
	"\254\123\134\350\154\160\056\307\207\103\114\210\030\237\266\376"
	"\225\156\165\320\131\272\034\000\317\002\053\267\350\060\013\224"
	"\203\150\174\360\330\252\267\140\356\004\350\006\244\237\004\072"
	"\015\172\012\147\064\046\150\003\050\223\273\020\303\307\245\107"
	"\057\041\067\010\314\356\150\272\363\120\300\230\357\305\322\375"
	"\077\334\144\163\003\314\167\054\137\062\074\043\371\342\152\051"
	"\003\241\061\317\220\231\211\204\352\112\034\331\017\356\327\116"
	"\313\074\301\316\010\071\373\150\153\067\214\145\032\366\217\035"
	"\230\300\355\050\132\167\255\104\301\311\036\320\267\365\037\203"
	"\061\341\122\072\032\115\243\206\205\057\354\237\046\173\274\276"
	"\073\251\346\226\041\223\332\342\135\370\263\025\356\322\230\040"
	"\263\352\133\316\067\376\124\274\056\100\133\124\274\030\022\370"
	"\302\371\216\343\215\150\305\352\141\170\000\120\113\230\160\376"
	"\203\314\315\272\312\041\167\371\142\322\115\036\353\140\026\255"
	"\131\245\220\347\015\126\322\157\317\322\300\032\153\061\031\356"
	"\375\346\250\310\010\040\301\153\363\016\211\336\156\240\214\310"
	"\105\035\257\123\163\202\303\102\124\203\135\277\265\166\256\262"
	"\135\126\172\146\167\073\321\152\112\133\110\271\373\325\201\101"
	"\362\061\225\145\263\130\250\010\334\005\310\221\174\166\103\332"
	"\315\276\100\104\372\021\256\104\154\367\375\150\314\177\252\276"
	"\260\077\044\144\227\315\154\164\323\065\005\117\253\111\052\170"
	"\007\152\274\001\174\153\105\350\143\103\121\060\302\373\357\163"
	"\072\023\327\322\341\104\106\264\171\113\004\044\224\056\235\234"
	"\230\132\235\025\305\343\375\051\046\117\131\351\112\110\134\204"
	"\134\064\126\076"
#define      tst2_z	19
#define      tst2	((&data[3524]))
	"\362\350\366\264\223\055\332\074\242\223\272\256\301\357\006\301"
	"\214\107\165\251\127\207\027\175\045\264"
#define      xecc_z	15
#define      xecc	((&data[3549]))
	"\266\323\216\377\361\117\152\243\354\123\276\222\375\306\312\254"
	"\175"/* End of data[] */;
#define      hide_z	4096
#define SETUID 0	/* Define as 1 to call setuid(0) at start of script */
#define DEBUGEXEC	0	/* Define as 1 to debug execvp calls */
#define TRACEABLE	1	/* Define as 1 to enable ptrace the executable */
#define HARDENING	0	/* Define as 1 to disable ptrace/dump the executable */
#define HARDENINGSP	0	/* Define as 1 to disable bash child process */
#define BUSYBOXON	0	/* Define as 1 to enable work with busybox */

/* rtc.c */

#include <sys/stat.h>
#include <sys/types.h>

#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>

/* 'Alleged RC4' */

static unsigned char stte[256], indx, jndx, kndx;

/*
 * Reset arc4 stte. 
 */
void stte_0(void)
{
	indx = jndx = kndx = 0;
	do {
		stte[indx] = indx;
	} while (++indx);
}

/*
 * Set key. Can be used more than once. 
 */
void key(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		do {
			tmp = stte[indx];
			kndx += tmp;
			kndx += ptr[(int)indx % len];
			stte[indx] = stte[kndx];
			stte[kndx] = tmp;
		} while (++indx);
		ptr += 256;
		len -= 256;
	}
}

/*
 * Crypt data. 
 */
void arc4(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		indx++;
		tmp = stte[indx];
		jndx += tmp;
		stte[indx] = stte[jndx];
		stte[jndx] = tmp;
		tmp += stte[indx];
		*ptr ^= stte[tmp];
		ptr++;
		len--;
	}
}

/* End of ARC4 */

#if HARDENING

#include <sys/ptrace.h>
#include <sys/wait.h>
#include <signal.h>
#include <sys/prctl.h>
#define PR_SET_PTRACER 0x59616d61

/* Seccomp Sandboxing Init */
#include <stdlib.h>
#include <stdio.h>
#include <stddef.h>
#include <string.h>
#include <unistd.h>
#include <errno.h>

#include <sys/types.h>
#include <sys/prctl.h>
#include <sys/syscall.h>
#include <sys/socket.h>

#include <linux/filter.h>
#include <linux/seccomp.h>
#include <linux/audit.h>

#define ArchField offsetof(struct seccomp_data, arch)

#define Allow(syscall) \
    BPF_JUMP(BPF_JMP+BPF_JEQ+BPF_K, SYS_##syscall, 0, 1), \
    BPF_STMT(BPF_RET+BPF_K, SECCOMP_RET_ALLOW)

struct sock_filter filter[] = {
    /* validate arch */
    BPF_STMT(BPF_LD+BPF_W+BPF_ABS, ArchField),
    BPF_JUMP( BPF_JMP+BPF_JEQ+BPF_K, AUDIT_ARCH_X86_64, 1, 0),
    BPF_STMT(BPF_RET+BPF_K, SECCOMP_RET_KILL),

    /* load syscall */
    BPF_STMT(BPF_LD+BPF_W+BPF_ABS, offsetof(struct seccomp_data, nr)),

    /* list of allowed syscalls */
    Allow(exit_group),  /* exits a processs */
    Allow(brk),         /* for malloc(), inside libc */
    Allow(mmap),        /* also for malloc() */
    Allow(munmap),      /* for free(), inside libc */

    /* and if we don't match above, die */
    BPF_STMT(BPF_RET+BPF_K, SECCOMP_RET_KILL),
};
struct sock_fprog filterprog = {
    .len = sizeof(filter)/sizeof(filter[0]),
    .filter = filter
};

/* Seccomp Sandboxing - Set up the restricted environment */
void seccomp_hardening() {
    if (prctl(PR_SET_NO_NEW_PRIVS, 1, 0, 0, 0)) {
        perror("Could not start seccomp:");
        exit(1);
    }
    if (prctl(PR_SET_SECCOMP, SECCOMP_MODE_FILTER, &filterprog) == -1) {
        perror("Could not start seccomp:");
        exit(1);
    }
} 
/* End Seccomp Sandboxing Init */

void arc4_hardrun(void * str, int len) {
    //Decode locally
    char tmp2[len];
    memcpy(tmp2, str, len);

	unsigned char tmp, * ptr = (unsigned char *)tmp2;

    int lentmp = len;

#if HARDENINGSP
    //Start tracing to protect from dump & trace
    if (ptrace(PTRACE_TRACEME, 0, 0, 0) < 0) {
        printf("Operation not permitted\n");
        kill(getpid(), SIGKILL);
        exit(1);
    }

    //Decode Bash
    while (len > 0) {
        indx++;
        tmp = stte[indx];
        jndx += tmp;
        stte[indx] = stte[jndx];
        stte[jndx] = tmp;
        tmp += stte[indx];
        *ptr ^= stte[tmp];
        ptr++;
        len--;
    }

    //Exec bash script
    system(tmp2);

    //Empty script variable
    memcpy(tmp2, str, lentmp);

    //Sinal to detach ptrace
    ptrace(PTRACE_DETACH, 0, 0, 0);
    exit(0);

    /* Seccomp Sandboxing - Start */
    seccomp_hardening();

    exit(0);
#endif /* HARDENINGSP Exit here anyway*/

    int pid, status;
    pid = fork();

    if(pid==0) {

        //Start tracing to protect from dump & trace
        if (ptrace(PTRACE_TRACEME, 0, 0, 0) < 0) {
            printf("Operation not permitted\n");
            kill(getpid(), SIGKILL);
            _exit(1);
        }

        //Decode Bash
        while (len > 0) {
            indx++;
            tmp = stte[indx];
            jndx += tmp;
            stte[indx] = stte[jndx];
            stte[jndx] = tmp;
            tmp += stte[indx];
            *ptr ^= stte[tmp];
            ptr++;
            len--;
        }

        //Exec bash script
        system(tmp2);

        //Empty script variable
        memcpy(tmp2, str, lentmp);

        //Sinal to detach ptrace
        ptrace(PTRACE_DETACH, 0, 0, 0);
        exit(0);
    }
    else {
        wait(&status);
    }

    /* Seccomp Sandboxing - Start */
    seccomp_hardening();

    exit(0);
} 
#endif /* HARDENING */

/*
 * Key with file invariants. 
 */
int key_with_file(char * file)
{
	struct stat statf[1];
	struct stat control[1];

	if (stat(file, statf) < 0)
		return -1;

	/* Turn on stable fields */
	memset(control, 0, sizeof(control));
	control->st_ino = statf->st_ino;
	control->st_dev = statf->st_dev;
	control->st_rdev = statf->st_rdev;
	control->st_uid = statf->st_uid;
	control->st_gid = statf->st_gid;
	control->st_size = statf->st_size;
	control->st_mtime = statf->st_mtime;
	control->st_ctime = statf->st_ctime;
	key(control, sizeof(control));
	return 0;
}

#if DEBUGEXEC
void debugexec(char * sh11, int argc, char ** argv)
{
	int i;
	fprintf(stderr, "shll=%s\n", sh11 ? sh11 : "<null>");
	fprintf(stderr, "argc=%d\n", argc);
	if (!argv) {
		fprintf(stderr, "argv=<null>\n");
	} else { 
		for (i = 0; i <= argc ; i++)
			fprintf(stderr, "argv[%d]=%.60s\n", i, argv[i] ? argv[i] : "<null>");
	}
}
#endif /* DEBUGEXEC */

void rmarg(char ** argv, char * arg)
{
	for (; argv && *argv && *argv != arg; argv++);
	for (; argv && *argv; argv++)
		*argv = argv[1];
}

void chkenv_end(void);

int chkenv(int argc)
{
	char buff[512];
	unsigned long mask, m;
	int l, a, c;
	char * string;
	extern char ** environ;

	mask = (unsigned long)getpid();
	stte_0();
	 key(&chkenv, (void*)&chkenv_end - (void*)&chkenv);
	 key(&data, sizeof(data));
	 key(&mask, sizeof(mask));
	arc4(&mask, sizeof(mask));
	sprintf(buff, "x%lx", mask);
	string = getenv(buff);
#if DEBUGEXEC
	fprintf(stderr, "getenv(%s)=%s\n", buff, string ? string : "<null>");
#endif
	l = strlen(buff);
	if (!string) {
		/* 1st */
		sprintf(&buff[l], "=%lu %d", mask, argc);
		putenv(strdup(buff));
		return 0;
	}
	c = sscanf(string, "%lu %d%c", &m, &a, buff);
	if (c == 2 && m == mask) {
		/* 3rd */
		rmarg(environ, &string[-l - 1]);
		return 1 + (argc - a);
	}
	return -1;
}

void chkenv_end(void){}

#if HARDENING

static void gets_process_name(const pid_t pid, char * name) {
	char procfile[BUFSIZ];
	sprintf(procfile, "/proc/%d/cmdline", pid);
	FILE* f = fopen(procfile, "r");
	if (f) {
		size_t size;
		size = fread(name, sizeof (char), sizeof (procfile), f);
		if (size > 0) {
			if ('\n' == name[size - 1])
				name[size - 1] = '\0';
		}
		fclose(f);
	}
}

void hardening() {
    prctl(PR_SET_DUMPABLE, 0);
    prctl(PR_SET_PTRACER, -1);

    int pid = getppid();
    char name[256] = {0};
    gets_process_name(pid, name);

    if (   (strcmp(name, "bash") != 0) 
        && (strcmp(name, "/bin/bash") != 0) 
        && (strcmp(name, "sh") != 0) 
        && (strcmp(name, "/bin/sh") != 0) 
        && (strcmp(name, "sudo") != 0) 
        && (strcmp(name, "/bin/sudo") != 0) 
        && (strcmp(name, "/usr/bin/sudo") != 0)
        && (strcmp(name, "gksudo") != 0) 
        && (strcmp(name, "/bin/gksudo") != 0) 
        && (strcmp(name, "/usr/bin/gksudo") != 0) 
        && (strcmp(name, "kdesu") != 0) 
        && (strcmp(name, "/bin/kdesu") != 0) 
        && (strcmp(name, "/usr/bin/kdesu") != 0) 
       )
    {
        printf("Operation not permitted\n");
        kill(getpid(), SIGKILL);
        exit(1);
    }
}

#endif /* HARDENING */

#if !TRACEABLE

#define _LINUX_SOURCE_COMPAT
#include <sys/ptrace.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <fcntl.h>
#include <signal.h>
#include <stdio.h>
#include <unistd.h>

#if !defined(PT_ATTACHEXC) /* New replacement for PT_ATTACH */
   #if !defined(PTRACE_ATTACH) && defined(PT_ATTACH)
       #define PT_ATTACHEXC	PT_ATTACH
   #elif defined(PTRACE_ATTACH)
       #define PT_ATTACHEXC PTRACE_ATTACH
   #endif
#endif

void untraceable(char * argv0)
{
	char proc[80];
	int pid, mine;

	switch(pid = fork()) {
	case  0:
		pid = getppid();
		/* For problematic SunOS ptrace */
#if defined(__FreeBSD__)
		sprintf(proc, "/proc/%d/mem", (int)pid);
#else
		sprintf(proc, "/proc/%d/as",  (int)pid);
#endif
		close(0);
		mine = !open(proc, O_RDWR|O_EXCL);
		if (!mine && errno != EBUSY)
			mine = !ptrace(PT_ATTACHEXC, pid, 0, 0);
		if (mine) {
			kill(pid, SIGCONT);
		} else {
			perror(argv0);
			kill(pid, SIGKILL);
		}
		_exit(mine);
	case -1:
		break;
	default:
		if (pid == waitpid(pid, 0, 0))
			return;
	}
	perror(argv0);
	_exit(1);
}
#endif /* !TRACEABLE */

char * xsh(int argc, char ** argv)
{
	char * scrpt;
	int ret, i, j;
	char ** varg;
	char * me = argv[0];
	if (me == NULL) { me = getenv("_"); }
	if (me == 0) { fprintf(stderr, "E: neither argv[0] nor $_ works."); exit(1); }

	ret = chkenv(argc);
	stte_0();
	 key(pswd, pswd_z);
	arc4(msg1, msg1_z);
	arc4(date, date_z);
	if (date[0] && (atoll(date)<time(NULL)))
		return msg1;
	arc4(shll, shll_z);
	arc4(inlo, inlo_z);
	arc4(xecc, xecc_z);
	arc4(lsto, lsto_z);
	arc4(tst1, tst1_z);
	 key(tst1, tst1_z);
	arc4(chk1, chk1_z);
	if ((chk1_z != tst1_z) || memcmp(tst1, chk1, tst1_z))
		return tst1;
	arc4(msg2, msg2_z);
	if (ret < 0)
		return msg2;
	varg = (char **)calloc(argc + 10, sizeof(char *));
	if (!varg)
		return 0;
	if (ret) {
		arc4(rlax, rlax_z);
		if (!rlax[0] && key_with_file(shll))
			return shll;
		arc4(opts, opts_z);
#if HARDENING
	    arc4_hardrun(text, text_z);
	    exit(0);
       /* Seccomp Sandboxing - Start */
       seccomp_hardening();
#endif
		arc4(text, text_z);
		arc4(tst2, tst2_z);
		 key(tst2, tst2_z);
		arc4(chk2, chk2_z);
		if ((chk2_z != tst2_z) || memcmp(tst2, chk2, tst2_z))
			return tst2;
		/* Prepend hide_z spaces to script text to hide it. */
		scrpt = malloc(hide_z + text_z);
		if (!scrpt)
			return 0;
		memset(scrpt, (int) ' ', hide_z);
		memcpy(&scrpt[hide_z], text, text_z);
	} else {			/* Reexecute */
		if (*xecc) {
			scrpt = malloc(512);
			if (!scrpt)
				return 0;
			sprintf(scrpt, xecc, me);
		} else {
			scrpt = me;
		}
	}
	j = 0;
#if BUSYBOXON
	varg[j++] = "busybox";
	varg[j++] = "sh";
#else
	varg[j++] = argv[0];		/* My own name at execution */
#endif
	if (ret && *opts)
		varg[j++] = opts;	/* Options on 1st line of code */
	if (*inlo)
		varg[j++] = inlo;	/* Option introducing inline code */
	varg[j++] = scrpt;		/* The script itself */
	if (*lsto)
		varg[j++] = lsto;	/* Option meaning last option */
	i = (ret > 1) ? ret : 0;	/* Args numbering correction */
	while (i < argc)
		varg[j++] = argv[i++];	/* Main run-time arguments */
	varg[j] = 0;			/* NULL terminated array */
#if DEBUGEXEC
	debugexec(shll, j, varg);
#endif
	execvp(shll, varg);
	return shll;
}

int main(int argc, char ** argv)
{
#if SETUID
   setuid(0);
#endif
#if DEBUGEXEC
	debugexec("main", argc, argv);
#endif
#if HARDENING
	hardening();
#endif
#if !TRACEABLE
	untraceable(argv[0]);
#endif
	argv[1] = xsh(argc, argv);
	fprintf(stderr, "%s%s%s: %s\n", argv[0],
		errno ? ": " : "",
		errno ? strerror(errno) : "",
		argv[1] ? argv[1] : "<null>"
	);
	return 1;
}
